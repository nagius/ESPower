<!DOCTYPE html>
<html lang="en"><head>
 <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
   <meta name="prefer-datetime-locale" content="en-gb">
<title>A Lithium Battery Charger with Load Sharing | Zak’s Electronics Blog ~*</title>
<meta name="generator" content="Jekyll v4.2.2">
<meta property="og:title" content="A Lithium Battery Charger with Load Sharing">
<meta name="author" content="Zak Kemble">
<meta property="og:locale" content="en">
<meta name="description" content="You may have found that charging your project’s lithium battery while at the same time trying to use your circuit didn’t quite workout, with problems like the circuit not turning on and the battery never finish charging. Even an LED can cause the battery to never finish charging.">
<meta property="og:description" content="You may have found that charging your project’s lithium battery while at the same time trying to use your circuit didn’t quite workout, with problems like the circuit not turning on and the battery never finish charging. Even an LED can cause the battery to never finish charging.">
<link rel="canonical" href="https://blog.zakkemble.net/a-lithium-battery-charger-with-load-sharing/">
<meta property="og:url" content="https://blog.zakkemble.net/a-lithium-battery-charger-with-load-sharing/">
<meta property="og:site_name" content="Zak’s Electronics Blog ~*">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2013-05-23T14:34:34+01:00">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="A Lithium Battery Charger with Load Sharing">
<meta name="twitter:site" content="@ZakKemble">
<meta name="twitter:creator" content="@Zak Kemble">
<script async="" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/universal.js"></script><script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Zak Kemble"},"dateModified":"2013-05-23T14:34:34+01:00","datePublished":"2013-05-23T14:34:34+01:00","description":"You may have found that charging your project’s lithium battery while at the same time trying to use your circuit didn’t quite workout, with problems like the circuit not turning on and the battery never finish charging. Even an LED can cause the battery to never finish charging.","headline":"A Lithium Battery Charger with Load Sharing","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.zakkemble.net/a-lithium-battery-charger-with-load-sharing/"},"url":"https://blog.zakkemble.net/a-lithium-battery-charger-with-load-sharing/"}</script>
 <meta name="keywords" content="avr, lithium, battery, charger, load sharing">
<link rel="apple-touch-icon" sizes="180x180" href="https://blog.zakkemble.net/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://blog.zakkemble.net/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://blog.zakkemble.net/favicon-16x16.png">
<link rel="manifest" href="https://blog.zakkemble.net/site.webmanifest">
<link rel="mask-icon" href="https://blog.zakkemble.net/safari-pinned-tab.svg" color="#da532c">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#da532c">
<link rel="shortcut icon" href="https://blog.zakkemble.net/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Zak's Electronics Blog ~*">
<meta name="application-name" content="Zak's Electronics Blog ~*">
<meta name="msapplication-config" content="/browserconfig.xml">
    <link rel="preconnect" href="https://fonts.googleapis.com/">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com/">
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com/" crossorigin="">
    <link rel="preconnect" href="https://fonts.googleapis.com/">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com/">
    <link rel="preconnect" href="https://cdn.jsdelivr.net/">
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net/">
  <link rel="stylesheet" href="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/css2.css">
  <link rel="preconnect" href="https://www.google-analytics.com/" crossorigin="use-credentials">
  <link rel="dns-prefetch" href="https://www.google-analytics.com/">
  <link rel="preconnect" href="https://www.googletagmanager.com/" crossorigin="anonymous">
  <link rel="dns-prefetch" href="https://www.googletagmanager.com/">
<link rel="stylesheet" href="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/bootstrap.css">
<link rel="stylesheet" href="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/all.css">
<link rel="stylesheet" href="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/style_003.css">
  <link rel="stylesheet" href="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/magnific-popup.css">
  <script src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/jquery.js"></script>
    <script async="" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/js"></script>
<script>
function removeUtmParams()
{
	function paramIsNotUtm(param) { return param.slice(0, 4) !== 'utm_'; }
	if (history && history.replaceState && location.search)
	{
		var params = location.search.slice(1).split('&');
		var newParams = params.filter(paramIsNotUtm);
		if (newParams.length < params.length)
		{
			var search = newParams.length ? '?' + newParams.join('&') : '';
			var url = location.pathname + search + location.hash;
			history.replaceState(null, null, url);
		}
	}
}
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-12913798-12');
gtag('event', 'page_view', { 'event_callback': function() {
	removeUtmParams();
}});
setTimeout(removeUtmParams, 10000);
</script>
<script type="text/javascript">
  class ModeToggle {
    static get MODE_KEY() { return "mode"; }
    static get MODE_ATTR() { return "data-mode"; }
    static get DARK_MODE() { return "dark"; }
    static get LIGHT_MODE() { return "light"; }
    static get ID() { return "mode-toggle"; }
    constructor() {
      if (this.hasMode) {
        if (this.isDarkMode) {
          if (!this.isSysDarkPrefer) {
            this.setDark();
          }
        } else {
          if (this.isSysDarkPrefer) {
            this.setLight();
          }
        }
      }
      let self = this;
      /* always follow the system prefers */
      this.sysDarkPrefers.addEventListener("change", () => {
        if (self.hasMode) {
          if (self.isDarkMode) {
            if (!self.isSysDarkPrefer) {
              self.setDark();
            }
          } else {
            if (self.isSysDarkPrefer) {
              self.setLight();
            }
          }
          self.clearMode();
        }
        self.notify();
      });
    } /* constructor() */
    get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); }
    get isSysDarkPrefer() { return this.sysDarkPrefers.matches; }
    get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; }
    get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; }
    get hasMode() { return this.mode != null; }
    get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); }
    /* get the current mode on screen */
    get modeStatus() {
      if (this.isDarkMode
        || (!this.hasMode && this.isSysDarkPrefer)) {
        return ModeToggle.DARK_MODE;
      } else {
        return ModeToggle.LIGHT_MODE;
      }
    }
    setDark() {
      $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
    }
    setLight() {
      $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
    }
    clearMode() {
      $('html').removeAttr(ModeToggle.MODE_ATTR);
      sessionStorage.removeItem(ModeToggle.MODE_KEY);
    }
    /* Notify another plugins that the theme mode has changed */
    notify() {
      window.postMessage({
        direction: ModeToggle.ID,
        message: this.modeStatus
      }, "*");
    }
  } /* ModeToggle */
  const toggle = new ModeToggle();
  function flipMode() {
    if (toggle.hasMode) {
      if (toggle.isSysDarkPrefer) {
        if (toggle.isLightMode) {
          toggle.clearMode();
        } else {
          toggle.setLight();
        }
      } else {
        if (toggle.isDarkMode) {
          toggle.clearMode();
        } else {
          toggle.setDark();
        }
      }
    } else {
      if (toggle.isSysDarkPrefer) {
        toggle.setLight();
      } else {
        toggle.setDark();
      }
    }
    toggle.notify();
  } /* flipMode() */
</script>
	<link rel="stylesheet" href="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/style.css">
	<link rel="stylesheet" href="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/style_004.css">
	<link rel="stylesheet" href="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/style_002.css">
	<link rel="stylesheet" href="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/a.css">
	<link type="application/rss+xml" rel="alternate" href="https://blog.zakkemble.net/feed/" title="Zak's Electronics Blog ~* » Feed">
	<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://blog.zakkemble.net/xmlrpc.php?rsd">
	<script>
		(function (s, e, n, d, er) {
			s['Sender'] = er;
			s[er] = s[er] || function () {
				(s[er].q = s[er].q || []).push(arguments)
			}, s[er].l = 1 * new Date();
			var a = e.createElement(n),
				m = e.getElementsByTagName(n)[0];
			a.async = 1;
			a.src = d;
			m.parentNode.insertBefore(a, m)
		})(window, document, 'script', 'https://cdn.sender.net/accounts_resources/universal.js', 'sender');
		sender('1428d8f92c2781');
	</script>
</head>
 <body data-spy="scroll" data-target="#toc" data-topbar-visible="false">
<div id="sidebar" class="d-flex flex-column align-items-end">
 <div class="profile-wrapper text-center">
   <div id="avatar">
      <a href="https://blog.zakkemble.net/" class="mx-auto">
          <img src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/avatar.jpg" alt="avatar" onerror="this.style.display='none'">
      </a>
   </div>
   <div class="site-title mt-3">
      <a href="https://blog.zakkemble.net/">Zak's Electronics Blog ~*</a>
   </div>
   <div class="site-subtitle font-italic">~</div>
 </div>
 <ul class="w-100">
   <li class="nav-item">
      <a href="https://blog.zakkemble.net/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
   </li>
	<li class="nav-item">
		<a href="#" id="emailsubscribe2" class="nav-link">
			<i class="fa-fw fas fa-envelope ml-xl-3 mr-xl-3 unloaded"></i>
			<span>SUBSCRIBE</span>
		</a>
	</li>
   <li class="nav-item">
      <a href="https://blog.zakkemble.net/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
        <span>CATEGORIES</span>
      </a>
   </li>
   <li class="nav-item">
      <a href="https://blog.zakkemble.net/tags/" class="nav-link">
        <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i>
        <span>TAGS</span>
      </a>
   </li>
   <li class="nav-item">
      <a href="https://blog.zakkemble.net/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        <span>ARCHIVES</span>
      </a>
   </li>
   <li class="nav-item">
      <a href="https://blog.zakkemble.net/about-me/" class="nav-link">
        <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i>
        <span>ABOUT ME</span>
      </a>
   </li>
   <li class="nav-item">
      <a href="https://blog.zakkemble.net/privacy-policy/" class="nav-link">
        <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i>
        <span>PRIVACY POLICY</span>
      </a>
   </li>
 </ul>
	<div style="padding-bottom:1rem;width:100%;text-align:center">
		Found something useful here?
		<a href="https://donate.zakkemble.net/blog/" target="_blank" rel="noopener noreferrer">
			<img src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/btn_donateCC_LG.gif" alt="Donate">
		</a>
	</div>
 <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center">
      <button class="mode-toggle btn" aria-label="Switch Mode">
        <i class="fas fa-adjust"></i>
      </button>
        <span class="icon-border"></span>
      <a href="https://github.com/ZakKemble" aria-label="github" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
      <a href="https://twitter.com/ZakKemble" aria-label="twitter" target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
      <a href="https://www.youtube.com/user/ZakKemble" aria-label="youtube" target="_blank" rel="noopener">
        <i class="fab fa-youtube"></i>
      </a>
      <a href="javascript:location.href = 'mailto:' + ['contact','zakkemble.net'].join('@')" aria-label="email">
        <i class="fas fa-envelope"></i>
      </a>
      <a href="https://blog.zakkemble.net/feed/" aria-label="rss">
        <i class="fas fa-rss"></i>
      </a>
 </div>
</div>
<div id="topbar-wrapper">
 <div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4">
    <span id="breadcrumb">
          <span>
            <a href="https://blog.zakkemble.net/">
              Home
            </a>
          </span>
            <span>A Lithium Battery Charger with Load Sharing</span>
    </span>
    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>
   <div id="topbar-title">
      Post
   </div>
    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search...">
    </span>
    <span id="search-cancel">Cancel</span>
 </div>
</div>
   <div id="main-wrapper" class="d-flex justify-content-center">
     <div id="main" class="container pl-xl-4 pr-xl-4">
<div class="row">
 <div id="core-wrapper" class="col-12 col-lg-12 col-xl-12 pr-xl-4">
   <div class="post pl-1 pr-1 pl-md-2 pr-md-2">
<ol>
	<li class="dropdown">
		<div class="dropdown-content">
			<a href="https://blog.zakkemble.net/mail-notifier-wifi-edition/">Mail Notifier - WiFi Edition</a>
			<a href="https://blog.zakkemble.net/routerpi-compute-module-4-router/">RouterPi - A Compute Module 4 Router</a>
			<a href="https://blog.zakkemble.net/iot-and-a-door-entry-system/">IoT and a Door Entry System</a>
			<a href="https://blog.zakkemble.net/rpi4-pci-express-bridge-chip/">Raspberry Pi 4 PCI-Express Bridge “Chip”</a>
			<a href="https://blog.zakkemble.net/smart-power-bank-keep-alive/">Smart Power Bank Keep-Alive</a>
			<a href="https://blog.zakkemble.net/remote-mail-notifier-and-gps-tracker/">Remote Mail Notifier (and GPS Tracker)</a>
			<a href="https://blog.zakkemble.net/laptop-bench-power-supply/">Laptop Bench Power Supply</a>
			<a href="https://blog.zakkemble.net/a-tiny-electronic-dice/">A Tiny Electronic Dice</a>
			<a href="https://blog.zakkemble.net/car-rev-alarm-and-gear-indicator/">Car Rev Alarm and Gear Indicator</a>
			<a href="https://blog.zakkemble.net/nwatch-wristwatch-kit/">N|Watch – DIY Wristwatch Kit</a>
			<a href="https://blog.zakkemble.net/diy-digital-wristwatch/">DIY Digital Wristwatch</a>
			<a href="https://blog.zakkemble.net/usb-power-switch-and-filter/">USB Power Switch and Filter</a>
			<a href="https://blog.zakkemble.net/bluetooth-net-monitor/">Bluetooth Net Monitor</a>
			<a href="https://blog.zakkemble.net/avr-usb-rgb-led-controller/">AVR USB RGB LED Controller</a>
			<a href="https://blog.zakkemble.net/cpu-usage-leds/">CPU Usage LEDs</a>
			<a href="https://blog.zakkemble.net/avr-microcontroller-based-pwm-fan-controllers/">AVR microcontroller based PWM fan controllers</a>
		</div>
		<a href="#" class="dropdown-link">
			<i class="fa-fw fas fa-stream"></i>
			<span>PROJECTS</span>
		</a>
	</li>
	<li class="dropdown">
		<div class="dropdown-content">
			<a href="https://blog.zakkemble.net/avrdudess-a-gui-for-avrdude/">AVRDUDESS – A GUI for AVRDUDE</a>
			<a href="https://blog.zakkemble.net/avr-gcc-builds/">AVR-GCC 12.1.0 for Windows 32 and 64 bit</a>
		</div>
		<a href="#" class="dropdown-link">
			<i class="fa-fw fas fa-stream"></i>
			<span>SOFTWARE</span>
		</a>
	</li>
	<li class="dropdown">
		<div class="dropdown-content">
			<a href="https://blog.zakkemble.net/si4463-radio-library-avr-arduino/">Si4463 Radio Library for AVR and Arduino</a>
			<a href="https://blog.zakkemble.net/nrf905-avrarduino-librarydriver/">nRF905 Radio Library for AVR and Arduino</a>
			<a href="https://blog.zakkemble.net/mcp2221-hid-library/">MCP2221 HID Library</a>
			<a href="https://blog.zakkemble.net/millisecond-tracking-library-for-avr/">Millisecond tracking library for AVR</a>
		</div>
		<a href="#" class="dropdown-link">
			<i class="fa-fw fas fa-stream"></i>
			<span>LIBRARIES</span>
		</a>
	</li>
	<li class="dropdown">
		<div class="dropdown-content">
			<a href="https://blog.zakkemble.net/rpi-compiling-a-module-for-the-64-bit-kernel/">Raspberry Pi – Compiling a Module for the 64-bit Kernel</a>
			<a href="https://blog.zakkemble.net/a-lithium-battery-charger-with-load-sharing/">A Lithium Battery Charger with Load Sharing</a>
			<a href="https://blog.zakkemble.net/modifying-ram-spd-data/">Modifying RAM SPD Data</a>
			<a href="https://blog.zakkemble.net/getting-bluetooth-modules-talking-to-each-other/">Getting Bluetooth modules talking to each other</a>
		</div>
		<a href="#" class="dropdown-link">
			<i class="fa-fw fas fa-stream"></i>
			<span>HOW-TO</span>
		</a>
	</li>
	<li class="dropdown">
		<div class="dropdown-content">
			<a href="https://blog.zakkemble.net/repairing-a-samsung-ht-c460-home-cinema-system/">Repairing a Samsung HT-C460 Home Cinema System</a>
			<a href="https://blog.zakkemble.net/ic-samples/">IC samples</a>
			<a href="https://blog.zakkemble.net/lcd-image-viewer/">LCD Image Viewer</a>
			<a href="https://blog.zakkemble.net/first-time-with-arduino-and-avr-microcontrollers/">First time with Arduino and AVR microcontrollers</a>
			<a href="https://blog.zakkemble.net/ir-jammer/">IR jammer</a>
			<a href="https://blog.zakkemble.net/leds-looking-pretty/">LEDs looking pretty</a>
			<a href="https://blog.zakkemble.net/pwm-fan-controllers-using-the-555-timer-ic/">PWM Fan controllers using the 555 timer IC</a>
			<a href="https://blog.zakkemble.net/joule-thief/">Joule Thief</a>
			<a href="https://blog.zakkemble.net/fm-radio-transmitter/">FM Radio Transmitter</a>
		</div>
		<a href="#" class="dropdown-link">
			<i class="fa-fw fas fa-stream"></i>
			<span>MORE STUFF</span>
		</a>
	</li>
</ol>
<h1 data-toc-skip="">A Lithium Battery Charger with Load Sharing</h1>
<div class="post-meta text-muted">
    <span>
      Posted
<em class="" data-toggle="tooltip" data-placement="bottom" data-original-title="Thu, 23 May 2013 14:34" title="">23 May 2013</em>
    </span>
 <div class="d-flex justify-content-between">
    <span>
      By
      <em>
        Zak kemble
      </em>
    </span>
   <div>
<span class="readtime" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="1482 words">
  <em>8 min</em> read</span>
   </div>
 </div>
</div>
<div class="post-content">
 <p>You may have found that charging your project’s lithium battery 
while at the same time trying to use your circuit didn’t quite workout, 
with problems like the circuit not turning on and the battery never 
finish charging. Even an LED can cause the battery to never finish 
charging.<br>
This article goes through creating a battery charger with load sharing 
(also known as power-path) that can properly charge the battery and have
 the main circuit run normally. The charging IC we’ll be using is the 
popular <a rel="nofollow noopener noreferrer" href="https://ww1.microchip.com/downloads/en/DeviceDoc/MCP73831-Family-Data-Sheet-DS20001984H.pdf" target="_blank">MCP73831/2</a> from Microchip for single-cell Li-Po and Li-Ion batteries with a maximum charge current of 500mA.
We’ll also be adopting the load sharing design from <a rel="nofollow noopener noreferrer" href="http://ww1.microchip.com/downloads/en/AppNotes/01149c.pdf" target="_blank">Microchip app note AN1149</a>.</p>
<p><img src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/MCP73831-2-pinout.png" alt="Image" class="img-z img-center" style="" loading="lazy" data-proofer-ignore="" width="388" height="152"></p>
<h2 id="issues-when-not-using-load-sharing"><span class="mr-2">Issues when not using load sharing</span><a href="#issues-when-not-using-load-sharing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p>During the preconditioning and constant-current charge phases the 
charger IC will limit current supplied to the battery and load. If this 
limit has been set to 40mA and the load wants 30mA, only 10mA will be 
left to charge the battery. If the load wants 50mA then 40mA will come 
from the charger and 10mA from the battery, which will discharge the 
battery rather than charge it. If the battery is already dead then the 
load will be starved of current, causing the voltage to drop, the load 
probably won’t operate correctly and the battery won’t charge.</p>
<p>During the constant-voltage charge phase the charger will normally 
wait until the current through the battery is below a particular 
percentage (usually 7.5% of the set charge current) and then finish 
charging. If a load is present the current will probably never go below 
this level and charging will never seem to finish.</p>
<h2 id="charger-ic-variations"><span class="mr-2">Charger IC variations</span><a href="#charger-ic-variations" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p>There are a few variations of the charging IC, MCP73831/2 means 
MCP73831 and MCP73832. The only difference between these two is the 
charging state output (STAT pin).</p>
<style>.highlight-last-row tr:nth-child(6){background-color:#f4ff45 !important;}</style>
<div class="table-wrapper"><table class="tbl-full-width highlight-last-row">
<thead>
   <tr>
     <th>Charge state</th>
     <th>MCP73831</th>
     <th>MCP73832</th>
   </tr>
 </thead>
 <tbody>
   <tr>
     <td>Shutdown</td>
     <td>Hi-Z</td>
     <td>Hi-Z</td>
   </tr>
   <tr>
     <td>No battery present</td>
     <td>Hi-Z</td>
     <td>Hi-Z</td>
   </tr>
   <tr>
     <td>Preconditioning</td>
     <td>Low</td>
     <td>Low</td>
   </tr>
   <tr>
     <td>Constant-current fast charge</td>
     <td>Low</td>
     <td>Low</td>
   </tr>
   <tr>
     <td>Constant voltage</td>
     <td>Low</td>
     <td>Low</td>
   </tr>
   <tr>
     <td>Charge complete – standby</td>
     <td>High</td>
     <td>Hi-Z</td>
   </tr>
 </tbody>
</table></div>
<p>There are also variations which set how the battery is charged in 
relation to when and how long to precondition, fast charge and so on. 
AC, AD, AT and DC are the 4 types. The AC type seems to be the ‘normal’ 
type that is used in the IC datasheet. More information about each 
charging phase can be found in the app note above.</p>
<h2 id="basic-charge-circuit"><span class="mr-2">Basic Charge Circuit</span><a href="#basic-charge-circuit" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p><img src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/MCP73831_basic.png" alt="Image" class="img-z img-center" style="" loading="lazy" data-proofer-ignore="" width="568" height="189"></p>
<p>This design is the minimum required for the MCP73831/2 to charge a 
lithium battery (well, R1 and LED1 could also be removed), but problems 
will arise when charging and connecting a load to the battery, as 
discussed above.</p>
<h2 id="charge-circuit-with-load-sharing"><span class="mr-2">Charge circuit with load sharing</span><a href="#charge-circuit-with-load-sharing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p><img src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/MCP73831_loadshare.png" alt="Image" class="img-z img-center" style="" loading="lazy" data-proofer-ignore="" width="802" height="262"></p>
<p>Adding load sharing only requires an additional 3 components. When 
USB power is applied this circuit will turn off Q1, and as long as (V<sub>usb</sub> – D1 V<sub>F</sub>) is above (V<sub>bat</sub> – Q1 V<sub>SD</sub>)
 then the load will instead use power from USB through D1. This allows 
the battery to charge normally without any outside disturbances.</p>
<p><strong>Q1</strong> is a P channel MOSFET. When USB power is applied 
Q1 will turn off and stop current flowing from the battery to the load, 
effectively disconnecting the battery. The load will then use power from
 USB through D1. The MOSFET you choose should have as low R<sub>DS(on)</sub>
 as possible to minimize power loss, should be able to handle the 
current your circuit is going to draw from the battery and has a V<sub>GS(th)</sub> between 0V and -2.4V.</p>
<p><strong>D1</strong> is to prevent current flowing from the battery 
into the charging power source. D1 should be a schottky diode that can 
handle the loads’ maximum current draw. The forward voltage drop doesn’t
 matter too much, but lower the better to reduce power loss when powered
 by USB. The absolute maximum drop is (V<sub>INmin</sub> – (V<sub>BATmax</sub> – V<sub>SD</sub>) = V<sub>Fmax</sub>),
 the USB 2.0 standard specifies 5V±0.25V, most lithium batteries charge 
to 4.2V and internal MOSFET diodes have a drop of around 0.6V, so (4.75 –
 (4.2 – 0.6) = 1.15). This maximum forward voltage drop is so the source
 (load side) voltage of Q1 doesn’t go below the drain (battery side) 
voltage, otherwise the internal diode of Q1 will begin to conduct which 
will interfere with the battery charging. Reverse current leakage of 
schottky diodes might be a problem if ultra low power consumption is 
needed.</p>
<p><strong>R2</strong> is to make sure Q1 turns on and connects the battery to the load when the charging power source is removed.</p>
<p><strong>C3</strong> is an extra decoupling/bypass capacitor.</p>
<p>Another important point to think about is the reverse leakage current
 of D1, which could be up to a few hundred microamp (schottky diodes are
 very leaky).<br>
This leakage current will create a small voltage at the MOSFET gate 
which, if high enough, could cause the MOSFET to not turn back on 
properly when the main Vin power is removed.</p>
<p>To see if Q1 is turning on properly place a voltmeter across Q1’s 
drain and source pins and it should read a few millivolt depending on 
load and the MOSFET’s on resistance, e.g. with a load of 100mA and R<sub>DS(on)</sub> of 50mΩ then the voltage drop should be 5mV.</p>
<p>To minimize the gate voltage you can either use a diode with lower 
leakage current (which will also improve battery life) or reduce the 
value of R2, or a bit of both.</p>
<p>To figure out what value R2 should be to keep the gate voltage to a sane level (lets go for a V<sub>target</sub> of 1V) we first workout the effective resistance D1 has at the batteries’ max voltage:<br>
Our example diode has a leakage (I<sub>R</sub>) of 200uA @ 4.2V (you can
 find leakage info in the datasheet for your diode, or you can measure 
it yourself by applying a voltage backwards across the diode and 
measuring the current).</p>
<p>R<sub>D</sub> = V<sub>BATmax</sub> / I<sub>R</sub><br>
R<sub>D</sub> = 4.2 / 0.0002<br>
R<sub>D</sub> = 21KΩ</p>
<p>So now we can treat D1 and R2 as a voltage divider, we just need to 
workout what value R2 should be so that the voltage at the MOSFET’s gate
 meets our V<sub>target</sub>.</p>
<p>R2 = V<sub>target</sub> * R<sub>D</sub> / (V<sub>BATmax</sub> – V<sub>target</sub>)<br>
R2 = 1 * 21000 / (4.2 – 1)<br>
R2 = 6.56KΩ</p>
<p>So when using a diode with a leakage current of 200uA @ 4.2V, R2 must
 be no more than 6.56K to keep the MOSFET’s gate at 1V. I’d recommend 
not going over 100K for R2.</p>
<p>This also means D1 and R2 will be leaking a total of 152uA from the battery (I = V<sub>BATmax</sub> / (R<sub>D</sub> + R2)).</p>
<p>It’s probably a good idea to do these calculations for V<sub>BATmin</sub> (around 2.4 – 3V) too.</p>
<h2 id="charge-circuit-with-load-sharing-and-additional-microcontroller"><span class="mr-2">Charge circuit with load sharing and additional microcontroller</span><a href="#charge-circuit-with-load-sharing-and-additional-microcontroller" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p>Here’s an even further modified charge circuit. A microcontroller can
 be used to sense when USB power is applied, when the battery is 
charging, enable/disable charging, control charge rate and measure the 
battery voltage. This information could be displayed on something like 
an LCD.</p>
<p><a href="https://blog.zakkemble.net/wp-content/uploads/2013/05/MCP73831_loadshare_mcu2.png" target="_blank" class="img-link"><img src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/MCP73831_loadshare_mcu2-300x163.png" alt="Image" class="img-z img-center" style="" loading="lazy" data-proofer-ignore="" width="300" height="163"></a></p>
<div class="table-wrapper"><table class="tbl-full-width">
<thead>
   <tr>
     <th>Pin</th>
     <th>I/O</th>
     <th>Pull-up</th>
     <th>Info</th>
   </tr>
 </thead>
 <tbody>
   <tr>
     <td>PD3 (5)</td>
     <td>Input</td>
     <td>Enabled</td>
     <td>Charger STAT pin sense. LOW means the battery is charging.</td>
   </tr>
   <tr>
     <td>PD6 (12)</td>
     <td>Input</td>
     <td>Disabled</td>
     <td>When USB power is applied this pin will go HIGH.</td>
   </tr>
   <tr>
     <td>PD4 (6)</td>
     <td>Output</td>
     <td>–</td>
     <td>Controls charging.</td>
   </tr>
   <tr>
     <td>PD5 (11)</td>
     <td>Output</td>
     <td>–</td>
     <td>Controls charging.</td>
   </tr>
   <tr>
     <td>PD7 (13)</td>
     <td>Output</td>
     <td>–</td>
     <td>Setting to HIGH will turn the level shifter and Q3 on which will allow current to flow through the divider.<br>Once an ADC reading has been taken this should be put back to LOW.</td>
   </tr>
   <tr>
     <td>ADC3 (26)</td>
     <td>ADC</td>
     <td>–</td>
     <td>Measure voltage. Internal 1.1V should be used as the reference voltage.</td>
   </tr>
 </tbody>
</table></div>
<p><strong>Charge rates</strong></p>
<div class="table-wrapper"><table class="tbl-full-width">
<thead>
   <tr>
     <th>Q2</th>
     <th>Q5</th>
     <th>Charge</th>
   </tr>
 </thead>
 <tbody>
   <tr>
     <td>Off</td>
     <td>Off</td>
     <td>Disabled</td>
   </tr>
   <tr>
     <td><strong>On</strong></td>
     <td>Off</td>
     <td>100mA (10K)</td>
   </tr>
   <tr>
     <td>Off</td>
     <td><strong>On</strong></td>
     <td>370mA (2.7K)</td>
   </tr>
   <tr>
     <td><strong>On</strong></td>
     <td><strong>On</strong></td>
     <td>470mA (2.7K || 10K = 2.126K)</td>
   </tr>
 </tbody>
</table></div>
<p>R2 and R3 voltage divider also serves as R2 100K pull-down resistor for Q1 in the first load sharing schematic.</p>
<p>Only the MCP7383<strong>2</strong> should be used in this case, using MCP7383<strong>1</strong>
 will drive the STAT pin HIGH with 5V when the battery finishes charging
 which will exceed the microcontrollers’ max pin voltage of VCC + 0.5V 
(2.5 + 0.5 = 3V max).</p>
<div class="table-wrapper"><table class="dllastestversion">
<tbody>
	<tr>
		<td style="text-align:center;padding:5px">
			<a href="https://blog.zakkemble.net/download/loadShare_20140613.c" class="img-link"><strong style="font-size:10px">LATEST</strong>
			<br>
			<img src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/archive.png" alt="Download" title="Download" data-proofer-ignore=""></a>
		</td>
		<td style="padding:5px">
			<a href="https://blog.zakkemble.net/download/loadShare_20140613.c"><strong>
				loadShare_20140613.c (3.68 KB)
			</strong>
			<br>
			Load sharing code example
			<br>
			MD5: C50476A4F66D332D6DBD29BEC05D13B4</a>
		</td>
	</tr>
</tbody>
</table></div>
<div class="table-wrapper"><table class="dloldversion">
<tbody>
	<tr>
		<td style="text-align:center;padding:5px">
			<a href="https://blog.zakkemble.net/download/loadShare.c" class="img-link"><strong style="font-size:10px">OLD</strong>
			<br>
			<img src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/archive.png" alt="Download" title="Download" data-proofer-ignore=""></a>
		</td>
		<td style="padding:5px">
			<a href="https://blog.zakkemble.net/download/loadShare.c"><strong>
				loadShare.c (2.71 KB)
			</strong>
			<br>
			Load sharing code example
			<br>
			MD5: 2D0DC4BCC9047756554131EBCE4773CF</a>
		</td>
	</tr>
</tbody>
</table></div>
<h2 id="extra"><span class="mr-2">Extra</span><a href="#extra" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<ul>
 <li>You should make sure your circuit can run on the full voltage range
 of the battery (usually 3V-4.2V, but sometimes down to 2.4V) as well as
 5V from USB.</li>
 <li>You should make sure that your charging power source can supply 
enough current to charge the battery as well as power the circuit.</li>
 <li>When charging at high currents be sure to have large enough PCB 
traces to dissipate the heat from the charging IC. Heat comes from the 
ground pin (VSS).</li>
</ul>
<p><em>March 9th 2014 – Added info about D1 reverse leakage and working out required R2 resistance.</em><br>
<em>June 13th 2014 – Updated microcontroller schematic to use more 
suitable BJTs instead of MOSFETs (cheaper, easier to find). Also added 
adjustable charge rate.</em></p>
</div>
<div class="post-tail-wrapper text-muted">
 <div class="post-meta mb-3">
    <i class="far fa-folder-open fa-fw mr-1"></i>
      <a href="https://blog.zakkemble.net/categories/power/">Power</a>
 </div>
 <div class="post-tail-bottom
    d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
   <div class="license-wrapper">
   </div>
<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons">
        <a rel="nofollow noopener noreferrer" href="https://twitter.com/intent/tweet?text=A+Lithium+Battery+Charger+with+Load+Sharing+-+Zak%27s+Electronics+Blog+~%2A&amp;url=https%3A%2F%2Fblog.zakkemble.net%2Fa-lithium-battery-charger-with-load-sharing%2F" data-toggle="tooltip" data-placement="top" title="" target="_blank" aria-label="Twitter" data-original-title="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
        <a rel="nofollow noopener noreferrer" href="https://www.facebook.com/sharer/sharer.php?title=A+Lithium+Battery+Charger+with+Load+Sharing+-+Zak%27s+Electronics+Blog+~%2A&amp;u=https%3A%2F%2Fblog.zakkemble.net%2Fa-lithium-battery-charger-with-load-sharing%2F" data-toggle="tooltip" data-placement="top" title="" target="_blank" aria-label="Facebook" data-original-title="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
        <a rel="nofollow noopener noreferrer" href="https://t.me/share/url?url=https%3A%2F%2Fblog.zakkemble.net%2Fa-lithium-battery-charger-with-load-sharing%2F&amp;text=A+Lithium+Battery+Charger+with+Load+Sharing+-+Zak%27s+Electronics+Blog+~%2A" data-toggle="tooltip" data-placement="top" title="" target="_blank" aria-label="Telegram" data-original-title="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a>
    <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="" data-title-succeed="Link copied successfully!" data-original-title="Copy link">
    </i>
  </span>
</div>
 </div>
</div>
   </div>
 </div>
</div>
<div class="row">
 <div id="tail-wrapper" class="col-12 col-lg-12 col-xl-12 pl-3 pr-3 pr-xl-4">
 <div id="comments">
	<h2 id="comments_count">222 Comments</h2>
	<p class="comment-form-jump">
		<a href="#respond" class="btn btn-sm">Skip to comment form</a>
	</p>
	<div id="comments_container" class=""><ol class="clearfix comments-list"><li id="comment-41368" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/4e0d731c5c74d00bb78351adafb26b94.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/4e0d731c5c74d00bb78351adafb26b94_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Felipe</span> on <span class="comment-date">September 18, 2013</span><br></li> <li class="single-comment-link"><a href="#comment-41368">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hi, 
<br>my name is Felipe and I have a question.
<br>I need use the MCP, but I need put a resistor between VBAT pin and 
Bat pin. Because this resistor, I am having problems with charge. The 
current of charging is lower than the ideal.
<br>You ever had this problem?</p></div></div></div><ol class="children"><li id="comment-41498" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">September 18, 2013</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-41498">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Whats the reason for having a resistor between VBAT and the battery?</p></div></div></div><ol class="children"><li id="comment-41518" class="comment depth-3 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/4e0d731c5c74d00bb78351adafb26b94.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/4e0d731c5c74d00bb78351adafb26b94_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Felipe</span> on <span class="comment-date">September 18, 2013</span><br></li> <li class="single-comment-link"><a href="#comment-41518">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>I will use my electronics in an environment with flammable gases. Is a norm in Brazil use this resistor.
<br>
<br>Sooner, I saw problem with my current of charge, its lowering very 
fast, in 15 minutes go to 150 mA, when my prog resistor is configured to
 300mA. I need solve it before. I no have capactors in my charge 
circuit, after add I return with notices.
<br>
<br>tnx</p></div></div></div><ol class="children"><li id="comment-41550" class="comment depth-4 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">September 18, 2013</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-41550">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hmm,
 well, you won't be able to get more current through the resistor unless
 you reduce the resistance or increase the voltage, but increasing the 
voltage would be a bad idea. The charging IC is not designed to have a 
resistor in series with the battery.</p></div></div></div></li></ol></li></ol></li></ol></li><li id="comment-54494" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/a66024c2c905210567b0215ed0a6d5c2.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/a66024c2c905210567b0215ed0a6d5c2_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Petr</span> on <span class="comment-date">October 31, 2013</span><br></li> <li class="single-comment-link"><a href="#comment-54494">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hi Zak,
<br>
<br>I am trying to understand MOSFETs and I've got some issues 
understanding your load sharing schema: the Q1's Vgs starts from -0.3 V 
(from its datasheet) and we use Schottky with say  0.4 V forward voltage
 drop (you compute that it can go as high as 1.15 V!). Now when the USB 
power of 5 V is attached then the gate has say 5.00 V and the source has
 0.4 V less (because of the D1 voltage drop), i.e. 4.6 V. That means the
 Q1 switch is closed because Vgs is -0.4 V (thanks to the D1). When the 
switch is closed the current flows from USB directly to battery and 
destroys it. That's first issue. Now say we disconnect the USB, the Q1's
 gate voltage is zero then. The Q1's source voltage is unknown, it's 
probably flying somewhere because it's connected to the load only. But 
the load can have low input resistance so we may suppose the voltage of 
Q1 source is zero as well. Now the Q1 is open (because Vgs = 0 V) thus 
the current from battery cannot flow to the load. That is the second 
issue.
<br>
<br>I probably missed something crucial but in my eyes this schema 
cannot work both with and without the USB power connected. Please 
enlighten me, thanks in advance!</p></div></div></div><ol class="children"><li id="comment-54503" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">October 31, 2013</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-54503">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hey,<br><br>2 problems: You're doing an extra step when working out Vgs and forgetting about the internal MOSFET diode.<br><br>When
 working out the Vgs, you only do Vgs = Vg - Vs (5V - 4.6V = 0.4V (not 
-0.4V)). That means the P-MOSFET is open/turned off when USB power is 
applied.<br><br>When USB is disconnected, with a high or low load 
resistance, the MOSFETs internal diode will conduct and the source 
voltage becomes Vs = Vbat - Vf (4.2V - 0.6V = 3.5V). Then Vgs = Vg - Vs 
(0V - 3.5V = -3.5V) which will close/turn on the P-MOSFET and bypass the
 internal diode.</p></div></div></div><ol class="children"><li id="comment-54507" class="comment depth-3 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/a66024c2c905210567b0215ed0a6d5c2.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/a66024c2c905210567b0215ed0a6d5c2_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Petr</span> on <span class="comment-date">October 31, 2013</span><br></li> <li class="single-comment-link"><a href="#comment-54507">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Oh,
 the Vgs error I made is obvious, thanks for correcting that. As for the
 MOSFETs internal diode - I indeed haven't realized it can be used for 
passing the voltage from drain to source (all usual schematics connect 
voltage to source, not drain, you know :-)
<br>Thanks a lot for the explanation!
<br>
<br>BTW, the Vgs can be as low as 2 V (for almost discharged battery) so
 we need a MOSFET with a rather low Vgs threshold, right? I suppose 
those with min 2 max 4 V Vgs(th) (like IRF9450) cannot be used for this.
 I'll need to find a smaller one than I have here.
<br>
<br>Could this load sharing be done with a N-channel MOSFET by any chance? I have a bunch of those handy... :)
<br>
<br>Thanks!</p></div></div></div><ol class="children"><li id="comment-54522" class="comment depth-4 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">October 31, 2013</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-54522">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>No problem :)<br><br>A
 LiPo/LiIon battery should never go as low as 2V, that makes it a 
dangerous battery. Absolute minimum should be 2.4V, but no less than 3V 
is preferred.<br>Vgs(th) of the IRF9450 is a little too high, it might 
work, but the Rds will be quite high. An N-MOSFET could probably be 
used, but not as a replacement, a complete circuit redesign would be 
needed.</p></div></div></div><ol class="children"><li id="comment-54564" class="comment depth-5 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/a66024c2c905210567b0215ed0a6d5c2.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/a66024c2c905210567b0215ed0a6d5c2_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Petr</span> on <span class="comment-date">October 31, 2013</span><br></li> <li class="single-comment-link"><a href="#comment-54564">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>FYI,
 the Vgs as low as 2 V is true for battery with about 2.6 V (I 
subtracted the Vf already) which is indeed slightly less than the 
preferred LiPo/LiIon voltage but still quite possible. The Vgs(th) of 
the Q1 should definitely be lower than 2 V.
<br>
<br>I am searching for a P-channel MOSFET with low Vgs(th) on Ebay now. 
Pity the AO3401 in SOT-23 are not easy to solder on universal PCB...</p></div></div></div><ol class="children"><li id="comment-54565" class="comment depth-6 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">October 31, 2013</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-54565">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Ah
 I see. FDD6685 might be OK, it's in a larger SMD package so it 
shouldn't be too hard to solder some wires to it. All the good stuff are
 SMD these days.</p></div></div></div></li></ol></li></ol></li></ol></li></ol></li></ol></li><li id="comment-56734" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/5e831f28edd966c15e39322fb0184206.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/5e831f28edd966c15e39322fb0184206_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Tarun</span> on <span class="comment-date">November 7, 2013</span><br></li> <li class="single-comment-link"><a href="#comment-56734">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>After
 building this circuit, I think the MOSFET in the schematic is 
backwards. Source should go to VBAT, Drain should go to output.</p></div></div></div><ol class="children"><li id="comment-56989" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">November 8, 2013</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-56989">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>No,
 if it was wired like that then there would be a short from USB to the 
battery; current will pass through D1 and the internal diode of the 
MOSFET into the battery.</p></div></div></div><ol class="children"><li id="comment-205958" class="comment depth-3 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/65754dbf7eaf94346f72535568031ead.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/65754dbf7eaf94346f72535568031ead_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Daniel</span> on <span class="comment-date">November 13, 2015</span><br></li> <li class="single-comment-link"><a href="#comment-205958">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>It
 looks backwards to me too. The mosfet will conduct whenever the gate 
voltage is lower than the source voltage right? so when Vin is not 
connected, wont both the source and the gate voltage be 0 causing the 
fet to stay in the "off" position?</p></div></div></div><ol class="children"><li id="comment-205962" class="comment depth-4 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">November 13, 2015</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-205962">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>When
 the MOSFET is off and Vin is removed the MOSFETs internal diode will 
conduct, bringing the source voltage to the battery minus the internal 
diode drop. If the battery is at 4.2V the source will be around 3.6V, 
meaning Vgs will be -3.6V causing the MOSFET to turn on and bypass the 
internal diode.</p></div></div></div><ol class="children"><li id="comment-205964" class="comment depth-5 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/65754dbf7eaf94346f72535568031ead.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/65754dbf7eaf94346f72535568031ead_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Daniel</span> on <span class="comment-date">November 13, 2015</span><br></li> <li class="single-comment-link"><a href="#comment-205964">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Ok so when Vin is plugged in and the mosfet is off, would current still flow from the battery through the internal diode?</p></div></div></div><ol class="children"><li id="comment-205965" class="comment depth-6 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">November 13, 2015</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-205965">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>No,
 because the voltage at the source will then be higher than the battery 
voltage, blocking any current through the internal diode.</p></div></div></div></li></ol></li><li id="comment-205966" class="comment depth-5 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/65754dbf7eaf94346f72535568031ead.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/65754dbf7eaf94346f72535568031ead_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Daniel</span> on <span class="comment-date">November 13, 2015</span><br></li> <li class="single-comment-link"><a href="#comment-205966">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Ok that makes sense, Thanks!</p></div></div></div></li></ol></li></ol></li></ol></li></ol></li><li id="comment-63506" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/f761e5c0452b6f8214a154a6280fa533.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/f761e5c0452b6f8214a154a6280fa533_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Lili</span> on <span class="comment-date">November 26, 2013</span><br></li> <li class="single-comment-link"><a href="#comment-63506">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>I
 have built this circuit and tested on both veroboard and a PCB. I have a
 problem when the USB is unplugged that there is a small (~0.5V) voltage
 that appears on the USB pin. I was wondering what causes this? I am 
using the same components as shown in the charge circuit with load 
sharing image.</p></div></div></div><ol class="children"><li id="comment-64660" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">November 30, 2013</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-64660">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>The
 small voltage is caused by the reverse leakage current of the schottky 
diode. It's nothing to worry about since available current is so small 
(&lt;1mA).</p></div></div></div></li><li id="comment-207988" class="comment depth-2 odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/6e529624b83c1fe9801c5a5ae2f9b482.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/6e529624b83c1fe9801c5a5ae2f9b482_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Philip</span> on <span class="comment-date">March 13, 2017</span><br></li> <li class="single-comment-link"><a href="#comment-207988">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>This
 is a bit of a late reply, but I built this and ran into the same issue 
as Lili. I think it's caused by the internal structure of the 
MCP73831/2, although I can't find anything in the datasheet to confirm.
<br>
<br>I tried removing the diode while running on battery, and the voltage
 still shows up on the VDD pin. I replaced the diode and lifted the VDD 
pin, and the voltage went to 0.
<br>
<br>Depending on the MOSFET you use, this shouldn't cause a problem with
 operation of the switching (it doesn't for me), but I had a detection 
circuit with VBUS driving the base of an NPN BJT, and there's enough 
current to turn it on even with the USB unplugged. Zak's voltage divider
 design is probably more workable.</p></div></div></div></li></ol></li><li id="comment-96853" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/ea60c58f047bb6c9de5c8299a801aec2.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/ea60c58f047bb6c9de5c8299a801aec2_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Dustin</span> on <span class="comment-date">January 9, 2014</span><br></li> <li class="single-comment-link"><a href="#comment-96853">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hello,
 Was curious if you could use this chip for say 2 cells in series? I'm 
wanting a 2 cell rechargeable battery pack that can be plugged into usb 
when needing to charge as well as turn on off when there is a load 
present.
<br>Thanks</p></div></div></div><ol class="children"><li id="comment-97668" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">January 10, 2014</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-97668">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>No,
 the IC only supports single cells. If the cells are in series then you 
will need a voltage booster since USB is only 5V and 2 cells go up to 
8.4V.</p></div></div></div></li></ol></li><li id="comment-99951" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/e5408cc988a6bf7af8cccce33147565a.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/e5408cc988a6bf7af8cccce33147565a_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">vpapanik</span> on <span class="comment-date">January 12, 2014</span><br></li> <li class="single-comment-link"><a href="#comment-99951">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Zak,
 thanks a million for your excellent article on load sharing. This 
detailed info was surely missing from the AN1149 application note :)
<br>
<br>I am using the same concept for my designs too, you can also check 
the PMV32UP P-Channel MOSFET from NXP, almost same low Rds, cheaper 
price.</p></div></div></div></li><li id="comment-99954" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/e5408cc988a6bf7af8cccce33147565a.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/e5408cc988a6bf7af8cccce33147565a_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">vpapanik</span> on <span class="comment-date">January 12, 2014</span><br></li> <li class="single-comment-link"><a href="#comment-99954">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>... and PMV16UN for the N-channel.
<br>
<br>I just saw your AVR setup too. That's an excellent design, well 
done. I would really appreciate if you could answer some questions I 
have, that would help me a lot.
<br>
<br>a) for extra input protection, maybe a reverse-biased 2.5V zener 
diode should be connected to the output of the R2/R3 voltage divider. I 
know that USB power is already protected but who knows... however, in 
the case of an external (e.g. wall) 5V source I think it is essential.
<br>
<br>b) are R4 and R8 and R10 really essential ? I see them in some 
designs, not in others, and I cannot really understand their purpose on 
limiting current to a MOSFET gate.
<br>
<br>c) is it possible to use the same P-channel MOSFET for Q2 and Q4 by putting it above R1 and R9, respectively ?
<br>
<br>Thanks a lot again !</p></div></div></div><ol class="children"><li id="comment-101358" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">January 13, 2014</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-101358">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Though
 PMV32UP and PMV16UN don't have any ESD protection (the 2 back-to-back 
zeners between gate and source). I like the extra protection :P<br><br>For anyone reading this, we're referring to <a href="http://blog.zakkemble.co.uk/diy-digital-wristwatch/" title="DIY Digital Wristwatch" rel="nofollow">DIY Digital Wristwatch</a>.<br><br>a)
 If the USB voltage goes over 6V (max pin voltage is VCC + 0.5V so 3V) 
R2 will limit the current a fair bit. I don't think it really needs the 
extra zener. You could instead change the ratio of the 2 resistors, 56K 
and 39K would work at 5V and be able to go up to a little over 7V before
 the output goes over 3V, but by then you've probably damaged the 
charger IC since its absolute max is 7V.<br><br>b) Well, MOSFET gates 
are like little capacitors. When turning them on and off you need to 
charge and discharge them and with no resistance you'll get large, but 
short, current surges which can damage stuff over time. Gate resistors 
can also be used to reduce ringing and EMI.<br><br>c) (I guess you meant Q3 not Q2, since Q2 is already a P-MOSFET. LS1 instead of R1 and R8 instead of R9)<br>No,
 Q3 and Q4 can't be P-MOSFETs. The purpose of Q3 is to level convert the
 controllers' 2.5V output up to the battery voltage level so Q2 can be 
turned off. You'd have to use the same level conversion technique with 
Q4 if you change it to a P-MOSFET.<br>MOSFETs need to have their gate 
voltage at close to its source voltage to turn off, the source voltage 
for Q2 and Q4 (if it was a P-MOSFET) would be whatever the battery is at
 (3V - 4.2V) and 2.5V from the controller wouldn't be enough to turn it 
off.</p></div></div></div><ol class="children"><li id="comment-103548" class="comment depth-3 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/e5408cc988a6bf7af8cccce33147565a.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/e5408cc988a6bf7af8cccce33147565a_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">vpapanik</span> on <span class="comment-date">January 14, 2014</span><br></li> <li class="single-comment-link"><a href="#comment-103548">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Thanks
 a very lot Zak, for your prompt answers, everything is perfectly clear.
 As far as the MOSFETs are concerned, the extra protection feature is 
really important so I am thinking of buying some strips of them too ! 
<br>
<br>In my last question I was referring to the microcontroller setup you
 are showing on this post (not in the wristwatch post), so we were 
talking the same thing :) I have a few questions on the wristwatch 
schematic as well and I will post them there. Your help is mostly 
appreciated !</p></div></div></div><ol class="children"><li id="comment-103649" class="comment depth-4 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">January 14, 2014</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-103649">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Lol
 oops, I had completely forgot about that part of the post &gt;.&lt; 
Though Q2 and Q4 still need to stay as N-MOSFETs because the 2.5V from 
the microcontroller won't be able to turn P-MOSFETs off.</p></div></div></div><ol class="children"><li id="comment-103684" class="comment depth-5 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/e5408cc988a6bf7af8cccce33147565a.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/e5408cc988a6bf7af8cccce33147565a_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">vpapanik</span> on <span class="comment-date">January 14, 2014</span><br></li> <li class="single-comment-link"><a href="#comment-103684">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Yes, absolutely true :) You've been mostly helpful for me to understand those MOSFET secret details !
<br>
<br>I also looked at the similar DMP2035U part from Diodes, same price, better max VDS (-20V) and lower RDSon (23 mOhms).
<br>
<br>http://tinypic.com/r/2mounhz/5</p></div></div></div><ol class="children"><li id="comment-104462" class="comment depth-6 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">January 16, 2014</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-104462">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>They
 can only handle a few amps so a few mOhms isn't really going to make 
much of a difference. I've been using DMG6968U and DMP1045U just because
 I've brought a load of them so at the moment they're my 
small-general-whatever-use-them-for-anything MOSFETs :D</p></div></div></div></li></ol></li></ol></li></ol></li></ol></li></ol></li><li id="comment-140268" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/995327a30dfd829e23bd60b56be54e9e.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/995327a30dfd829e23bd60b56be54e9e_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Marcello</span> on <span class="comment-date">February 23, 2014</span><br></li> <li class="single-comment-link"><a href="#comment-140268">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hello
 there. I need to charge two Li-Ion batteries that are both powering a 
device; I was already planning and building a circuit with 73831 when i 
came upon your "addendum" and thought it'd be very useful. I only have 
to modify the circuit a little, and i was wondering if you could tell me
 if it is right or not. Since i have to charge two batteries i simply 
doubled the 73831 part including the MOSFET, so that every battery 
(slightly different in mAh and wear) would charge independently. The 
only thing i didn't double is the final part with D1, R2 and C3 cause it
 would be redundant. Basically it's a twin charger circuits, meeting at 
the MOSFET sources to power the device. Do you think it could work?
<br>Thanks.</p></div></div></div><ol class="children"><li id="comment-141711" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">February 24, 2014</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-141711">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Your
 idea should work for charging, but I'm not sure about discharging. One 
battery might end up charging another at an uncontrolled rate 
(especially if you partially charge the batteries so they're all at 
different voltages), adding a diode just after each MOSFET source should
 fix that. Actually, if you add the diodes then there's no need for the 
MOSFETs since they're only acting as super low voltage drop diodes.</p></div></div></div></li></ol></li><li id="comment-144613" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/995327a30dfd829e23bd60b56be54e9e.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/995327a30dfd829e23bd60b56be54e9e_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Marcello</span> on <span class="comment-date">February 26, 2014</span><br></li> <li class="single-comment-link"><a href="#comment-144613">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>You're
 right, but now I realized my problem is slightly different: since the 
device's pcb is already being powered by Vcc when its jack is connected,
 what i'd need is only to disconnect the batteries while they're being 
charged. I thought of simply removing D1, cutting off the direct 
power-to-load; there shouldn't be problems about +5V going to the load 
since there's no flow of current through the MOSFET, am i right? (but 
i'm keeping C3 and R2).</p></div></div></div><ol class="children"><li id="comment-145221" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">February 26, 2014</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-145221">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>D1
 is to stop the battery from keeping the MOSFET turned off when VCC is 
removed, if the MOSFET is always off then it will just act like a normal
 diode because of the body diode.</p></div></div></div><ol class="children"><li id="comment-146386" class="comment depth-3 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/995327a30dfd829e23bd60b56be54e9e.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/995327a30dfd829e23bd60b56be54e9e_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Marcello</span> on <span class="comment-date">February 27, 2014</span><br></li> <li class="single-comment-link"><a href="#comment-146386">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>I
 know, but i meant to remove D1 entirely along with its line, because I 
don't need the load to be powered directly by Vin. I only need Q1 to 
stop the battery powering the load, my only doubt is: would there be 
some current going to the load when Q1 shuts the battery?</p></div></div></div><ol class="children"><li id="comment-148292" class="comment depth-4 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">February 28, 2014</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-148292">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Ah
 right, yes, current will pass through the MOSFETs body diode to VCC 
because there is no higher voltage to block it (normally from D1). A 
second P-MOSFET after Q1 with source connected to Q1 source, drain to 
VCC and gate to Vin should fix that, though.</p></div></div></div><ol class="children"><li id="comment-156290" class="comment depth-5 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/995327a30dfd829e23bd60b56be54e9e.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/995327a30dfd829e23bd60b56be54e9e_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Marcello</span> on <span class="comment-date">March 6, 2014</span><br></li> <li class="single-comment-link"><a href="#comment-156290">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Uhm,
 but in this case i'd have a double voltage drop from the battery.. 
alternatively i found a minirelay laying around, i'll see if i can use 
it, wish me luck..
<br>Anyway, thanks for your time.</p></div></div></div><ol class="children"><li id="comment-156292" class="comment depth-6 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">March 6, 2014</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-156292">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>The MOSFETs will only have a few millivolt drop, they turn on when Vin is removed. Though a relay would work too :P</p></div></div></div></li></ol></li></ol></li></ol></li></ol></li></ol></li><li id="comment-201043" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/2d38ace4ddc7f68de57b795b36bb27d1.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/2d38ace4ddc7f68de57b795b36bb27d1_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Jan Rychter</span> on <span class="comment-date">April 14, 2014</span><br></li> <li class="single-comment-link"><a href="#comment-201043">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Thanks for the great article. I wish I had this when I was starting my design —&nbsp;it would have saved me a lot of time.
<br>
<br>I'm curious —&nbsp;in the microcontroller circuit, why did you use 
Q2 and R4? Wouldn't the microcontroller's open-drain output serve 
effectively the same purpose? Were you worried about the current? From 
what I understand from the MCP73831/2 datasheet, we're looking at around
 500µA out of the PROG pin, so this should not be a problem I think?</p></div></div></div><ol class="children"><li id="comment-201051" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">April 14, 2014</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-201051">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>R4
 is because the gate of a MOSFET is like a small capacitor, there will 
be large current surges when turning the MOSFET on and off, the resistor
 limits the current to a safe level. Though really, since the MOSFET 
isn't going to be switched often and the DMG6968U gate capacitance is 
only 151pF it's probably OK to remove R4.<br>Q2 is used because of the 
ESD diodes giving a max pin voltage of VCC (2.5V) + 0.5 = 3V, setting 
the pin to High-Z will connect the PROG resistor to 2.5V via the ESD 
diode and you'll still get current passing through. If the controller is
 running without the regulator then it should be OK to remove Q2 and 
just use the controller output.</p></div></div></div><ol class="children"><li id="comment-201077" class="comment depth-3 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/2d38ace4ddc7f68de57b795b36bb27d1.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/2d38ace4ddc7f68de57b795b36bb27d1_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Jan Rychter</span> on <span class="comment-date">April 16, 2014</span><br></li> <li class="single-comment-link"><a href="#comment-201077">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Right
 — the body diodes. I always forget about those. Ok, I understand now. 
Luckily for this transistor Rdson doesn't really matter, so a really 
cheap one like a BSH111 (5Ω Rdson) should do fine.
<br>
<br>Thanks for explaining!</p></div></div></div></li></ol></li></ol></li><li id="comment-201068" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/bfc33211e672363800b2073e73ff7799.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/bfc33211e672363800b2073e73ff7799_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Milan Adhikari</span> on <span class="comment-date">April 16, 2014</span><br></li> <li class="single-comment-link"><a href="#comment-201068">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hello Zak,
<br>
<br>Thanks for the article its really good one to read when someone is 
starting with such design. I have a concern about powering the load. Now
 we are powering the load with 4.2V but what do I have to do in order to
 provide 5V to the load? Do I have to step up 4.2 V to 5V?</p></div></div></div><ol class="children"><li id="comment-201076" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">April 16, 2014</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-201076">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Yup, you will need a 5V boost converter like NCP1402.</p></div></div></div></li></ol></li><li id="comment-201071" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/9e2858312695fe23a7aedcd1d34d6553.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/9e2858312695fe23a7aedcd1d34d6553_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Hiren</span> on <span class="comment-date">April 16, 2014</span><br></li> <li class="single-comment-link"><a href="#comment-201071">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Thank you for the idea.</p></div></div></div></li><li id="comment-201397" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/c08186291928721f9ba94b7544c2a91a.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/c08186291928721f9ba94b7544c2a91a_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Roy</span> on <span class="comment-date">June 4, 2014</span><br></li> <li class="single-comment-link"><a href="#comment-201397">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hi Zak,
<br>
<br>Why not use a diode instead of Q1. No current will go into the 
battery, from the USB input, because this voltage level is higher than 
the charge voltage of the battery charger. What is the disadvantage in 
doing this using 2 diodes instead of a diode and a FET?
<br>
<br>Nice explanation of the circuit itself.
<br>
<br>Thanks.</p></div></div></div><ol class="children"><li id="comment-201400" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">June 4, 2014</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-201400">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Diodes
 have a relatively large voltage drop. When the MOSFET turns on current 
will bypass the diode, so instead of the ~250mV drop of a Schottky diode
 you get ~3mV drop of the MOSFET (assuming 30mΩ Rds and 100mA).</p></div></div></div><ol class="children"><li id="comment-208355" class="comment depth-3 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/ac97a69b376d4c0e48ed847ecc2ab7b3.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/ac97a69b376d4c0e48ed847ecc2ab7b3_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Paul</span> on <span class="comment-date">February 1, 2018</span><br></li> <li class="single-comment-link"><a href="#comment-208355">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Exactly what I was wondering. I was going to use just a diode...</p></div></div></div></li></ol></li></ol></li><li id="comment-201494" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/edb3af4ddded76374ec2d4e2f3defc41.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/edb3af4ddded76374ec2d4e2f3defc41_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Bernhard</span> on <span class="comment-date">June 12, 2014</span><br></li> <li class="single-comment-link"><a href="#comment-201494">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hello Zak,
<br>
<br>Thank your for your excellent article. I was searching for ages on 
the Microchip Website because it was missing some part like the MCP73831
 only with an extra disable or shutdown input. I also came to the 
solution using a MOSFET on the PROG pin. Since I am no Expert on MOSFETS
 I startet searching and found your blog.
<br>
<br>My Question is: Why not skip R10 and Q4 and connect R8 directly to 
the gate of Q3. My guess is that this might cause a current to flow from
 Bat+-&gt;R9-&gt;PD7-&gt;body diode-&gt;VCC-&gt;R2-&gt;R3-&gt;GND?
<br>
<br>I am planning to use this for a LPC but I guess the principle with the body diode is the same.
<br>
<br>Best Regards,
<br>Bernhard</p></div></div></div><ol class="children"><li id="comment-201497" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">June 12, 2014</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-201497">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Yup,
 the battery voltage will pass through the MCU internal diodes and kind 
of fight with the 2.5V regulator trying to bring it up to battery 
voltage, but not much bad stuff will happen because of the limited 
current through R9. Also because of the diode and everything the gate 
voltage will probably be clamped at 2.5V + diode drop, so you'll end up 
with around 3.2V at the P-MOSFET gate which won't be enough to turn it 
off (3.2 - 4.2V = -1Vgs). R2 and R3 aren't touched.<br>Q4 is to level 
shift the 2.5V up to battery voltage so the P-MOSFET can turn off. 
Removing the 2.5V regulator will mean you don't need all the level 
shifting stuff since everything will be at the same level.</p></div></div></div></li></ol></li><li id="comment-201834" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/93ba026eb41c1ed572f6f4a2faf0d187.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/93ba026eb41c1ed572f6f4a2faf0d187_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Eric</span> on <span class="comment-date">July 22, 2014</span><br></li> <li class="single-comment-link"><a href="#comment-201834">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Great write up. Confirmed a plan I had in mind for using p channel MOSFET for source switching. 
<br>
<br>Question: when the battery is charging, I just want the load circuit
 turned OFF, not powered by usb. To achieve this, I can simply omit the 
wire from usb to  load (and the Schottky diode), right?</p></div></div></div><ol class="children"><li id="comment-201836" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">July 22, 2014</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-201836">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Yup, but you will also have the swap the drain and source of Q1 so current doesn't go through the internal diode to the load.</p></div></div></div><ol class="children"><li id="comment-207923" class="comment depth-3 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/77eac8e7d95113f698b337da8ca09f67.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/77eac8e7d95113f698b337da8ca09f67_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">clovis</span> on <span class="comment-date">February 4, 2017</span><br></li> <li class="single-comment-link"><a href="#comment-207923">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>2 years late but whatever.....i will try and hope you are still there.
<br>I need a battery backup to power a SIM800L, BUT Sim800L needs from 3.2V to 4.2V supply.
<br>I am thinking of swapin drain and source and replacing D1 with a 
buck converter (from 5V to 4.0V). So the fet will open when there is 5V 
at Vin and will open when there is 0V.
<br>There will be no reverse current on Q1 when battery is fully charged
 (4.1V or 4.2V). And there could be reverse current on Q1 when the 
battery is charging (but TP4056 will try to keep B+ at 4.2 so there 
should be no rever current at Q1)
<br>
<br>What do you think?
<br>
<br>Can you see other solution to this?</p></div></div></div><ol class="children"><li id="comment-207925" class="comment depth-4 odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/77eac8e7d95113f698b337da8ca09f67.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/77eac8e7d95113f698b337da8ca09f67_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">clovis</span> on <span class="comment-date">February 4, 2017</span><br></li> <li class="single-comment-link"><a href="#comment-207925">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>sorry
 forgot to say that I have also replaced MCP73831/2 by TP4056 pcb (it 
has a B+ hole to connect the plus terminal of the battery).</p></div></div></div><ol class="children"><li id="comment-207927" class="comment depth-5 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/77eac8e7d95113f698b337da8ca09f67.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/77eac8e7d95113f698b337da8ca09f67_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">clovis</span> on <span class="comment-date">February 5, 2017</span><br></li> <li class="single-comment-link"><a href="#comment-207927">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>i have another idea.
<br>what if i make just as you did, but use a buck converter to 4.2V 
instead of the diode. The mosfet will open since battery will be at most
 4.2V and because of mosfet resitance.
<br>the load circuit consumes around 110mA typical and 2.1A pick 
(SIM800L making a call). When 2.1A is needed current will flow from the 
battery if the converter can't. handle. What do you think?
<br>Do you have any suggestion?</p></div></div></div><ol class="children"><li id="comment-207931" class="comment depth-6 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">February 7, 2017</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-207931">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>I'm
 still here :P Hmm, using a buck converter instead of the diode should 
work, but I don't think the part about the current coming from the 
battery if the converter can't handle it will work too well. The output 
voltage of the converter must drop to whatever voltage the battery is at
 before current is drawn from it. Different converter ICs will react 
differently to being overloaded. It would be best to just use a 
converter that can handle the peak current draw.
<br>
<br>Also, don't swap drain and source if you plan on supplying power to 
the load, though a diode or converter, as current will uncontrollably 
flow into the battery via the MOSFETs body diode :P.</p></div></div></div></li></ol></li><li id="comment-207933" class="comment depth-5 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/77eac8e7d95113f698b337da8ca09f67.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/77eac8e7d95113f698b337da8ca09f67_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">clovis</span> on <span class="comment-date">February 8, 2017</span><br></li> <li class="single-comment-link"><a href="#comment-207933">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>thanks
 for the advice. Yeah, did not see this, Battery will suck whatever 
current the converter could supply when the other side is at higher 
voltage (I was unconsiously assuming the electrons would prefer to go to
 load first :) and only some lost ants take left turn to the battery).
<br>
<br>I search for buck converters on ebay and some of them does not have reverse current protection.
<br>Maybe i will have to use a 9V power supply to the converter, use the
 converter to step down to 4.8V and use a diode after the converter. And
 use the same converter to supply to the TP4056 (it is supposed to 
accept from 4.5V to 5.5V).
<br>
<br>If I use a 5v power adapter (which can source up to 5.5V) using 
diodes will be dificult to keep in SIM800L acceptable voltage range at 
100mA and at 2.1A. And because many buck converters have voltage dropout
 abouve 1V at 2A, converter + diode will be very close to the minimum 
voltage SIM800L can accept.</p></div></div></div></li></ol></li></ol></li></ol></li></ol></li><li id="comment-201886" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/e5408cc988a6bf7af8cccce33147565a.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/e5408cc988a6bf7af8cccce33147565a_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">vpapanik</span> on <span class="comment-date">July 27, 2014</span><br></li> <li class="single-comment-link"><a href="#comment-201886">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Like this ?
<br>
<br>http://tinypic.com/view.php?pic=1z2ofhw&amp;s=8</p></div></div></div><ol class="children"><li id="comment-201896" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">July 27, 2014</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-201896">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>That would be correct.</p></div></div></div></li></ol></li><li id="comment-201889" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/e5408cc988a6bf7af8cccce33147565a.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/e5408cc988a6bf7af8cccce33147565a_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">vpapanik</span> on <span class="comment-date">July 27, 2014</span><br></li> <li class="single-comment-link"><a href="#comment-201889">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>I would like to thank you once more, especially for the new diode leakage current section !
<br>
<br>I couldn't explain the relatively large (1.1V) gate voltage I was 
getting, now it makes perfect sense :) my load sharing circuit is now 
fine tuned thanks to this brilliant post. 
<br>
<br>The only issue that I found is that the charging led remains on when
 the battery is not connected :( however, I can live with it, since I 
have no idea how to turn it off in that case.
<br>
<br>check also my implementation of a magnetic switch (for the regulator
 that goes after the load sharing circuit), you may find it helpful for 
new projects : https://www.youtube.com/watch?v=zG1mUlXUgnc</p></div></div></div><ol class="children"><li id="comment-201898" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">July 27, 2014</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-201898">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Good to hear :D<br>That magnetic switch looks pretty interesting, could definitely be useful.</p></div></div></div></li></ol></li><li id="comment-201895" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/e5408cc988a6bf7af8cccce33147565a.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/e5408cc988a6bf7af8cccce33147565a_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">vpapanik</span> on <span class="comment-date">July 27, 2014</span><br></li> <li class="single-comment-link"><a href="#comment-201895">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Nah,
 sorry, forget the last thing, I found it : it's because of the voltage 
divider for sensing battery voltage which pulls VBAT to ground when the 
battery is disconnected...
<br>
<br>http://tinypic.com/view.php?pic=2133x9x&amp;s=8</p></div></div></div><ol class="children"><li id="comment-201897" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">July 27, 2014</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-201897">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>That,
 and the capacitor is like a very small battery, you'll probably find 
that the LED is actually turning on and off very fast as it charges the 
capacitor then it discharges through the divider.</p></div></div></div><ol class="children"><li id="comment-201900" class="comment depth-3 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/e5408cc988a6bf7af8cccce33147565a.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/e5408cc988a6bf7af8cccce33147565a_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">vpapanik</span> on <span class="comment-date">July 27, 2014</span><br></li> <li class="single-comment-link"><a href="#comment-201900">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Is it possible to go for larger resistor divider values (20K/68K) ?</p></div></div></div><ol class="children"><li id="comment-201903" class="comment depth-4 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">July 27, 2014</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-201903">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Since
 it's just the battery voltage being measured (not a fast changing 
signal) you could try 1M + 1M with a 100n capacitor in parallel with the
 bottom resistor, though high value resistors will pick up noise like 
from touching the middle of the divider with your finger.</p></div></div></div><ol class="children"><li id="comment-201906" class="comment depth-5 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/e5408cc988a6bf7af8cccce33147565a.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/e5408cc988a6bf7af8cccce33147565a_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">vpapanik</span> on <span class="comment-date">July 27, 2014</span><br></li> <li class="single-comment-link"><a href="#comment-201906">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>I will !
<br>
<br>Now, when the magnetic switch is off, the battery consumes 100uA on 
the switch IC itself, another 50uA on the 20K/68K divider, and something
 more is unexpectedly leaking to the ADC input (MCU is turned off). Not 
bad, but it can be better.</p></div></div></div></li></ol></li></ol></li></ol></li></ol></li><li id="comment-203151" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/609f7443012beab78f6b20ad8d2e5c4d.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/609f7443012beab78f6b20ad8d2e5c4d_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">João Ferreira</span> on <span class="comment-date">October 22, 2014</span><br></li> <li class="single-comment-link"><a href="#comment-203151">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hi:
<br>
<br>I would like to use this circuit to power a automatic watering 
system. But instead of being powered via USB or AC adapter, i would like
 to use a solar panel as voltage source.
<br>I was thinking in a 5v solar panel, but my concern is about current.
 If the battery is charged and the watering system is in off state, the 
solar panel would be constantly trying to send current to the system, 
right?</p></div></div></div><ol class="children"><li id="comment-203299" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">October 30, 2014</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-203299">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Current
 can't be pushed into the system, the system decides how much it wants. 
It's the voltage you need to check, but I haven't used solar panels much
 so I'm not sure how they behave.</p></div></div></div></li></ol></li><li id="comment-203658" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/b7bbd62f7647f83cac236c4c3433d95a.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/b7bbd62f7647f83cac236c4c3433d95a_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Khue</span> on <span class="comment-date">November 23, 2014</span><br></li> <li class="single-comment-link"><a href="#comment-203658">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hi
 Zak, thank you for this tutorial. I wasn't sure before about the load 
sharing part of the circuit I needed to add. I'm trying to build a power
 supply for a 3.3V microcontroller. The power supply will be able to 
take an input of either 120VAC or 5V-18VDC. I have my schematic here: 
http://imgur.com/ACvB1Yk . In LTSpice, 3.3V out when there is a power 
input, but when I disconnect input power to the Battery Manager, my 
output is way lower than 3.3V. Do you know what's wrong?</p></div></div></div><ol class="children"><li id="comment-203699" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">November 25, 2014</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-203699">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>I
 don't think LTSpice simulates the MOSFET body diode for Q1 unless you 
manually add it in. The body diode is needed to get the MOSFET to turn 
on, without it Vgs would be 0V and the MOSFET would stay off.</p></div></div></div></li></ol></li><li id="comment-204770" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/99beada21a0dd89fe11d171de052eb77.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/99beada21a0dd89fe11d171de052eb77_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Marc Singer</span> on <span class="comment-date">May 1, 2015</span><br></li> <li class="single-comment-link"><a href="#comment-204770">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Nice post.  It has been very helpful.
<br>
<br>FYI, I implemented your design using an ON-Semi NTLJF3117P which is a
 small package containing both the p-fet and the schottky diode.
<br>
<br>One of my goals is to reduce the current of the system when it is 
idle.  My hunch is that if I increase the pull-down on VBus that the 
leakage current won't really change.  The voltage on VBus when there is 
no USB power will, but not the current.  Is this right?</p></div></div></div><ol class="children"><li id="comment-204771" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">May 1, 2015</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-204771">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Glad
 you found the post useful :) The NTLJF3117P schottky already has very 
low leakage, about 600nA @ 4.2V (equivalent to a 7M resistor). A 50K 
pull-down results in 29.79mV @ 595.74nA, doubling it to 100K results in 
59.15mV @ 591.55nA. So yeah, voltage pretty much doubled but current 
didn't change much. Because of the already very low schottky leakage the
 pull-down resistance doesn't really have much effect unless you start 
going into the megaohms range (but then the MOSFET could turn on from 
noise etc). You could use a less leaky normal diode instead of a 
schottky, the part about D1 mentions that you can have a drop of up to 
1.15V across the diode if the supply voltage doesn't go below 4.75V.</p></div></div></div><ol class="children"><li id="comment-204773" class="comment depth-3 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/99beada21a0dd89fe11d171de052eb77.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/99beada21a0dd89fe11d171de052eb77_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Marc Singer</span> on <span class="comment-date">May 1, 2015</span><br></li> <li class="single-comment-link"><a href="#comment-204773">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>I've
 been staring at the datasheet for the 3117 for some time and I don't 
see the numbers you're showing.  Are you reading the graph?  Is there 
another source for this information?</p></div></div></div><ol class="children"><li id="comment-204775" class="comment depth-4 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">May 1, 2015</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-204775">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>I'm looking at this graph http://www.onsemi.com/pub_link/Collateral/NTLJF3117P-D.PDF Page 7, Figure 15. Typical Reverse Current</p></div></div></div><ol class="children"><li id="comment-204776" class="comment depth-5 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/99beada21a0dd89fe11d171de052eb77.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/99beada21a0dd89fe11d171de052eb77_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Marc Singer</span> on <span class="comment-date">May 2, 2015</span><br></li> <li class="single-comment-link"><a href="#comment-204776">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>You threw me with '@4.2V'.
<br>
<br>I'm seeing 0.03v on Vbus with a 44K pull-down and a battery voltage 
of 4.175V.  This makes the leakage 680nA and the equivalent resistance 
be 6.1MOhm.
<br>
<br>Your eyes are keener than mine.</p></div></div></div></li></ol></li></ol></li></ol></li></ol></li><li id="comment-204772" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/99beada21a0dd89fe11d171de052eb77.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/99beada21a0dd89fe11d171de052eb77_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Marc Singer</span> on <span class="comment-date">May 1, 2015</span><br></li> <li class="single-comment-link"><a href="#comment-204772">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Zak,
<br>
<br>I've been trying to understand your comment about 'sane gate voltage.'
<br>
<br>With Vbus, Vg is VBUS and Vs is VBUS - Vf of the diode.  Vgs is 
going to be positive which will guarantee that the FET will be off.
<br>
<br>With no Vbus, Vg is going to be Vleak=Ir*R2 where Ir is the reverse 
leakage current through the diode and R2 is the Vbus pull-down.  Vs is 
going to be close to Vbat depending on Rdson and the forward drop in the
 body diode, but the conductance of the fet is going to be much more 
efficient than the body diode drop once the fet is on.  So, worst case 
Vgs is Vleak-(Vbat -Vf) which is going to be dominated by the battery 
voltage unless Vleak is really high.
<br>
<br>I think your comment is about making sure that Vleak isn't so high 
that it competes with Vbat-Vf.  So, when you say a target for Vg is 1V 
you are saying that you want it to be <strong>no more than 1V</strong>.  Even at Vbat of 3V, Vgs will be at least -1.6V when Vg is 1V.
<br>
<br>IOW, the sane gate voltage is being evaluated when there is no Vbus.  Yes?
<br>
<br>Cheers</p></div></div></div><ol class="children"><li id="comment-204774" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">May 1, 2015</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-204774">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Yup,
 everything you wrote there is correct, although the Vleak calculation 
is a little off - example 10uA leak and 1M pull-down ends up at 10V.<br>The 'sane gate voltage' is for when Vbus is removed and 'target voltage' would indeed mean 'no more than'.</p></div></div></div><ol class="children"><li id="comment-204777" class="comment depth-3 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/99beada21a0dd89fe11d171de052eb77.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/99beada21a0dd89fe11d171de052eb77_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Marc Singer</span> on <span class="comment-date">May 2, 2015</span><br></li> <li class="single-comment-link"><a href="#comment-204777">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Sure.
  As the pulldown is weakened (value of R2 increased) then Vg approaches
 Vs and eventually the fet won't turn on when Vbus is removed.  I think 
that for the case where Vg &lt; Vs, the calculation for for Vleak is a 
reasonable approximation.</p></div></div></div></li></ol></li></ol></li><li id="comment-204835" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/9f4304d73880da4a5be69e6644947dac.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/9f4304d73880da4a5be69e6644947dac_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">itanium</span> on <span class="comment-date">May 13, 2015</span><br></li> <li class="single-comment-link"><a href="#comment-204835">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hi,
<br>Can I use AO3401 for Q1?</p></div></div></div><ol class="children"><li id="comment-204844" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">May 14, 2015</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-204844">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Yeah, an AO3401 should work fine.</p></div></div></div></li></ol></li><li id="comment-204873" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/9121cc0ac63888b30b6fe118efbe53cb.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/9121cc0ac63888b30b6fe118efbe53cb_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Andrew Hannay</span> on <span class="comment-date">May 21, 2015</span><br></li> <li class="single-comment-link"><a href="#comment-204873">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hi Zak,
<br>I used lithium-ion charging for the first time on my last project 
(DIY Game and Watch -&gt;  
http://www.instructables.com/id/DIY-Game-Watch/). I didn't have problems
 with load sharing as I designed the software to have an auto shutdown 
so it drew very little current (5uA) and could charge without any 
problems.
<br>On my new project I want my circuit to stay active and it will draw 
somewhere in the range of 6mA which will be enough to stop the charger 
from shutting down hence why I found your excellent description 
explaining how you deal with it.
<br>Now, I had come up with a much simpler idea but I wanted to run it buy you to see what you think.
<br>The USB supply is 5v and I would take this to the charging IC and to
 my circuit via a diode like you have, which will give me a voltage of 
around 4.3v to 4.4v. I would connect the charger to the battery as 
normal, but then from the battery I was going to have another diode 
going to my circuit which would give a voltage of around 3.5v to 3.6v 
(4.2v - diode drop)  while the battery is charging.
<br>I was thinking that this would mean that the battery would not 
supply any current to my circuit as it's voltage would be lower than the
 voltage coming from the USB (less the diode drop). Would this work or 
would I end up sharing the current between the USB and the battery?
<br>Andrew</p></div></div></div><ol class="children"><li id="comment-204884" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">May 23, 2015</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-204884">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Nice looking project there :D<br>Yeah,
 your idea will work. The main purpose of the MOSFET in my design is to 
get rid of the diode voltage drop, there's still a diode from battery to
 main circuit since it's part of the MOSFET, but the diode is bypassed 
when the MOSFET turns on. You can also remove the pull-down resistor 
since that's just to make sure the MOSFET turns on when USB power is 
removed.<br>As long as the battery voltage minus diode drop is less than
 the USB voltage minus drop then no current will be drawn from the 
battery.</p></div></div></div></li></ol></li><li id="comment-204903" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/9121cc0ac63888b30b6fe118efbe53cb.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/9121cc0ac63888b30b6fe118efbe53cb_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Andrew Hannay</span> on <span class="comment-date">May 25, 2015</span><br></li> <li class="single-comment-link"><a href="#comment-204903">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Cheers. I simulated it online just to confirm it worked, which of course it did, it just seemed too simple :-)</p></div></div></div></li><li id="comment-205465" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/553c472c1f67a032ecc1ec0eea44fa09.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/553c472c1f67a032ecc1ec0eea44fa09_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Frank</span> on <span class="comment-date">September 6, 2015</span><br></li> <li class="single-comment-link"><a href="#comment-205465">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hi Zak, 
<br>
<br>Thanks for the awesome tutorial! 
<br>I'd been playing with something similar but without succes and I now understand why it wasn't working.
<br>
<br>I was wondering if you happen to know of any compatible through hole mosfets as an alternative to the DMP1045U-7?  
<br>
<br>Any advice would be much appreciated!</p></div></div></div><ol class="children"><li id="comment-205470" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">September 6, 2015</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-205470">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Through-hole
 P-Channel MOSFETs with a low enough Vgs seem to be quite hard to find, 
though these should be good for up to about 1A - FQPF27P06, SPP15P10PL, 
NDP6020P</p></div></div></div><ol class="children"><li id="comment-205579" class="comment depth-3 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/553c472c1f67a032ecc1ec0eea44fa09.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/553c472c1f67a032ecc1ec0eea44fa09_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Frank</span> on <span class="comment-date">September 20, 2015</span><br></li> <li class="single-comment-link"><a href="#comment-205579">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Thanks so much! 
<br>Just ordered a FQPF27P06 for testing.</p></div></div></div></li><li id="comment-207809" class="comment depth-3 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/0b1e87bc28d4e3111f3d3c9a3c912346.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/0b1e87bc28d4e3111f3d3c9a3c912346_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">nico</span> on <span class="comment-date">November 21, 2016</span><br></li> <li class="single-comment-link"><a href="#comment-207809">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>In the datasheets
<br>
<br>http://www.infineon.com/dgdl/Infineon-SPP15P10PLH-DS-v01_04-en.pdf?fileId=db3a304325afd6e001264b6ae1090c81
<br>https://www.fairchildsemi.com/datasheets/FQ/FQPF27P06.pdf
<br>https://cdn.sparkfun.com/datasheets/Components/General%20IC/NDP6020P.pdf
<br>
<br>I see that all mosfets you mentioned can handle  &gt; than 10A... Am
 I reading something incorrectly or why would you say "up to 1A"?</p></div></div></div><ol class="children"><li id="comment-207811" class="comment depth-4 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">November 24, 2016</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-207811">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hey
 Nico, up to 1A because the Vgs can be as low as 2.4V (Vgs will be at 
whatever voltage the battery currently is), which is not enough for much
 more current without a significant voltage drop across the MOSFET. See 
the On-Region Characteristics and Output Characteristics graphs in the 
datasheets.</p></div></div></div><ol class="children"><li id="comment-207814" class="comment depth-5 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/0b1e87bc28d4e3111f3d3c9a3c912346.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/0b1e87bc28d4e3111f3d3c9a3c912346_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">nico</span> on <span class="comment-date">November 24, 2016</span><br></li> <li class="single-comment-link"><a href="#comment-207814">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Oh of course, you' re right. Thanks for clarifying.
<br>
<br>Well, it would be too good to be true but, maybe introducing a regulator between the battery and the drain?
<br>The would also allow for a MOSFET with higher VGS, right?
<br>But would it interfere with other aspects of the design leading to breaking?</p></div></div></div><ol class="children"><li id="comment-207815" class="comment depth-6 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">November 24, 2016</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-207815">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Yeah
 you could add a boost regulator, but don't boost the voltage too much 
(try to keep it at 4.2V) otherwise D1 won't conduct when USB power is 
applied and you'll end up drawing power from the battery while it's 
trying to charge. See the first paragraph under the load sharing 
schematic and the paragraph about D1.</p></div></div></div></li></ol></li><li id="comment-207928" class="comment depth-5 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/77eac8e7d95113f698b337da8ca09f67.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/77eac8e7d95113f698b337da8ca09f67_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">clovis</span> on <span class="comment-date">February 6, 2017</span><br></li> <li class="single-comment-link"><a href="#comment-207928">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>why? From NDP6020P datasheet
<br>
<br>RDS(ON) Static Drain-Source On-Resistance V(GS) = -2.7 V, I(D) = -10A ====&gt; 0.059Ohms Typ and 0.07Ohms Max
<br>RDS(ON) Static Drain-Source On-Resistance V(GS) = -2.5 V, I(D) = -10A ====&gt;0.064Ohms Typ and 0.075Ohms Max</p></div></div></div><ol class="children"><li id="comment-207932" class="comment depth-6 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">February 7, 2017</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-207932">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Oh oops, you're right about the NDP6020P, that should be able to handle 10A or so. I must have missed that link at the time o_o.</p></div></div></div></li></ol></li></ol></li></ol></li></ol></li></ol></li><li id="comment-206051" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/b4a9374461a2d9a39f3744a6d42493be.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/b4a9374461a2d9a39f3744a6d42493be_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">JCB</span> on <span class="comment-date">November 25, 2015</span><br></li> <li class="single-comment-link"><a href="#comment-206051">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>can
 i to flip the mosfet(source conected  to battery and dreno conected to 
load), and replace D1 with a 3,8V LDO regulator with reverse current 
protection...
<br>because i need the voltage of charge from 3,3 to 4.2V
<br>
<br>Thanks</p></div></div></div><ol class="children"><li id="comment-206055" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">November 25, 2015</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-206055">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>That
 won't work. The orientation of the MOSFET is very important and 
shouldn't change, you'll end up damaging the battery if it's wrong. Just
 stick the regulator on the output of the load sharing circuit.</p></div></div></div><ol class="children"><li id="comment-206057" class="comment depth-3 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/b4a9374461a2d9a39f3744a6d42493be.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/b4a9374461a2d9a39f3744a6d42493be_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">JCB</span> on <span class="comment-date">November 25, 2015</span><br></li> <li class="single-comment-link"><a href="#comment-206057">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>But i have a problem.
<br>I need 3,8V on my load, and when battery is supplying the load the 
3,8V LDO regulator don´t work.. The BUCK/BOOST regulator is very 
expensive to my project.
<br>Do You have a suggestion?
<br>
<br>thanks for your attention</p></div></div></div><ol class="children"><li id="comment-206058" class="comment depth-4 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">November 25, 2015</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-206058">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>If
 you must have 3.8V then you will need a boost of some sort since the 
battery voltage can go down to around 3V. A buck/boost is kinda 
expensive as you say, so you could use just a boost to up the voltage to
 4V or so then use a 3.8V linear regulator after the boost.</p></div></div></div><ol class="children"><li id="comment-206059" class="comment depth-5 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/b4a9374461a2d9a39f3744a6d42493be.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/b4a9374461a2d9a39f3744a6d42493be_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">JCB</span> on <span class="comment-date">November 25, 2015</span><br></li> <li class="single-comment-link"><a href="#comment-206059">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Thanks so much ZAK
<br>
<br>I will search for a nice boost and LDO</p></div></div></div></li></ol></li></ol></li></ol></li></ol></li><li id="comment-206138" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/b4a9374461a2d9a39f3744a6d42493be.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/b4a9374461a2d9a39f3744a6d42493be_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">JCB</span> on <span class="comment-date">December 7, 2015</span><br></li> <li class="single-comment-link"><a href="#comment-206138">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hi Zak
<br>
<br>
<br>Can i insert a diode between pin 4 of MCP and the mosfet gate?
<br>I want to reduce the voltage on load when the supply is conected.
<br>
<br>
<br>thanks for your attention</p></div></div></div><ol class="children"><li id="comment-206157" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">December 9, 2015</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-206157">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>It
 would be best to swap out D1 with a diode with the voltage drop you 
want (or multiple diodes in series if 1 isn't enough). Make sure the 
total voltage drop doesn't go above 1.15V, see the section about D1 on 
working out the max drop.</p></div></div></div></li></ol></li><li id="comment-206380" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/547898cfb6744431b20ea1eab4ed009c.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/547898cfb6744431b20ea1eab4ed009c_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">chris</span> on <span class="comment-date">January 17, 2016</span><br></li> <li class="single-comment-link"><a href="#comment-206380">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>I'm a beginner, so my question might be a bit odd ;)
<br>Can I use an other DMP1045U instead of the D1 diode? Drain connected to VIN, Source to VCC and Gate as well to VIN.
<br>To avoid the voltage drop of the diode and at the same time, make 
sure no (only minimal) current flow to the USB input in case it is 
running on battery?</p></div></div></div><ol class="children"><li id="comment-206389" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">January 18, 2016</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-206389">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Nah, I see what you're trying to do, but it won't work in this case :P<br>Vgs
 needs to be less than about -1.2V to turn on, but with USB connected it
 will be 5V - 4.2V = 0.8V, meaning it will be off. And then when USB is 
removed it'll turn on because 0V - 4.2V = -4.2V!</p></div></div></div></li></ol></li><li id="comment-206494" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/1dff758691cd31d7a7d543eef5334c64.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/1dff758691cd31d7a7d543eef5334c64_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Gokku</span> on <span class="comment-date">February 2, 2016</span><br></li> <li class="single-comment-link"><a href="#comment-206494">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hey Zak,
<br>
<br>thanks a lot you tutorial and answers are awesome.
<br>I want to use the shematic for powering a Raspberry Pi. So I need 
5.2 Volts at the output and I will need arround 2A because I have a 
touch panel. So my question is when I use a USB adapter everything is 
fine because Raspi gets the supply via the wall adapter. But whe I plug 
off the suplly Raspi gets suplly from Battery and only 4,2V right? So I 
need a booster no? is there any booster which can handle 2A (or little 
more) and still gives out 5.2V?</p></div></div></div><ol class="children"><li id="comment-206499" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">February 3, 2016</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-206499">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Yeah,
 you'll need a boost regulator for the battery since it outputs 3V-4.2V.
 You could try this one - 
http://www.aliexpress.com/item/J35-Free-Shipping-DC-DC-Boost-Converter-3V-Up-5V-to-9V-2A-USB-Output-Voltage/32338265996.html
 It's adjustable so be sure to measure the output voltage before 
connecting it to the Pi.</p></div></div></div><ol class="children"><li id="comment-206536" class="comment depth-3 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/1dff758691cd31d7a7d543eef5334c64.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/1dff758691cd31d7a7d543eef5334c64_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Gokku</span> on <span class="comment-date">February 9, 2016</span><br></li> <li class="single-comment-link"><a href="#comment-206536">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>ok thanks a lot. i have ordered one of these: adafruit powerboost 1000 basic
<br>which should also work.
<br>
<br>I ordered the same Mosfet which you use in your shematic and the MCP73831. Now I bulded up the shematic....but it doesnt work. 
<br>
<br>How can I measure the Mosfet? without any supply it should be "open"
 between gate and source/drain and "closed" between drain and source no?
 or cant I measure without any supply?
<br>
<br>Can I add my EAGLE files somewhere?
<br>
<br>Thanks a lot again.</p></div></div></div><ol class="children"><li id="comment-206542" class="comment depth-4 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">February 10, 2016</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-206542">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Put
 your multimeter into voltage mode. When the battery is attached and USB
 is disconnected the MOSFET should be closed/have low voltage drop (less
 than 0.1V) across the source and drain and open/larger voltage drop 
(more than 0.5V) when USB is connected.<br>Google "file host" and upload the EAGLE files to one the websites.</p></div></div></div></li></ol></li></ol></li></ol></li><li id="comment-206884" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/bf692282f889ea616bd35182e7895894.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/bf692282f889ea616bd35182e7895894_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Diya Dinakaran</span> on <span class="comment-date">April 2, 2016</span><br></li> <li class="single-comment-link"><a href="#comment-206884">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Please clarify; whether the wiring of Q1 (as per the component symbol) is right or wrong ?</p></div></div></div><ol class="children"><li id="comment-206886" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">April 2, 2016</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-206886">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>All diagrams and symbols in the post are correct.</p></div></div></div></li></ol></li><li id="comment-207018" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/bc496f12af00771c06f3ef82254530bc.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/bc496f12af00771c06f3ef82254530bc_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">nico</span> on <span class="comment-date">April 23, 2016</span><br></li> <li class="single-comment-link"><a href="#comment-207018">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hi zack,
<br>Thanks for your info about the "load sharing circuit".
<br>I'm also going to build the circuit. I have just one question about the D1 diode.
<br>I have to set the voltage for the load to 4.2V max during the normal operation (when the main 
<br>power supply at 5V is connected) since my load works from 3.4 to 4.2. 
<br>I see you use the B130law and ,reading the datsheet , it gives me  0.38V of forwad voltage.
<br>This gives me 5v-0.38 =4.62V which would burn my load.
<br>I dont want to use any step down/up conversion since my load works 
perfectly between 3.4 to 4.2 V (lipo at 3.7V will power it when main DC 
power  fails)
<br>Could you please suggest wich diode I can use or maybe add to the circuit ?
<br>The current of the load  is 1A max.
<br>thanks
<br>nico</p></div></div></div><ol class="children"><li id="comment-207020" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">April 23, 2016</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-207020">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>You
 could put multiple diodes in series, but you also need to make sure 
there isn't too much drop otherwise the internal MOSFET diode will begin
 to conduct preventing the battery from fully charging. You should also 
measure the voltage drop at the loads minimum current, as the drop goes 
down as the current goes down, at 10mA the drop will be about 0.17V.<br>An easy, but not very efficient way that could work would be to use a zener regulator/clamp just before D1.</p></div></div></div></li></ol></li><li id="comment-207060" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/bc496f12af00771c06f3ef82254530bc.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/bc496f12af00771c06f3ef82254530bc_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">nico</span> on <span class="comment-date">April 28, 2016</span><br></li> <li class="single-comment-link"><a href="#comment-207060">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Ok ZaK,
<br>Thanks for reply. I thing I should put a DC-DC boost converter and I found one from Linear Technology (LT3759).
<br>
<br>About the kind of battery to charge : I'm going to charge a Lipo 
2200mAh since I want about 1A in both case (load under Main power or 
battery ). Do you think there's a limitation with this circuit? 
<br>thanks a lot again</p></div></div></div><ol class="children"><li id="comment-207062" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">April 28, 2016</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-207062">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>This
 load sharing with the LT3759 should be fine with 1A, though maybe swap 
D1 for a diode with slightly higher current rating otherwise you'll be 
pushing it to its max.</p></div></div></div></li></ol></li><li id="comment-207554" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/2ac5217adbf367b66705bb931ea24cd9.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/2ac5217adbf367b66705bb931ea24cd9_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Neo</span> on <span class="comment-date">August 5, 2016</span><br></li> <li class="single-comment-link"><a href="#comment-207554">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hi Zak,
<br>
<br>Thanks for the nice blog. I have one question, is it safe to connect
 STAT directly to the MCU I/O pin? Should there be a resistor in between
 to prevent from possible over current? Especially the high state of 
MCP73831 is 5V.
<br>
<br>Thanks.
<br>
<br>Neo</p></div></div></div><ol class="children"><li id="comment-207559" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">August 6, 2016</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-207559">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hey
 Neo, the MCP73832 (two) either pulls the STAT pin LOW or leaves it 
floating, it doesn't get connected to the 5V supply rail. Connecting the
 MCP73832 STAT pin directly to an I/O pin is safe. MCP73831 (one) STAT 
will need some level conversion, a single current limiting resistor is 
not the best idea as it will still try to pull the MCU 3.3V rail up to 
5V, a voltage divider or transistor would be better.</p></div></div></div></li></ol></li><li id="comment-207582" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/104c09a9d5dfbf7dd4399c046afd96e9.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/104c09a9d5dfbf7dd4399c046afd96e9_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Diogo</span> on <span class="comment-date">August 10, 2016</span><br></li> <li class="single-comment-link"><a href="#comment-207582">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hi,
<br>I have one question, see if you can help me
<br>
<br>I would like to use this circuit in a Arduino Project that uses a 3.3V microcontroller that I will build standalone.
<br>
<br>It's necessary in the end of the circuit to build a Voltage Regulator? Or I can connect directlly in my microcontroller.?
<br>
<br>Thanks Diogo</p></div></div></div><ol class="children"><li id="comment-207588" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">August 11, 2016</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-207588">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hey
 Diogo, you will need a regulator as the charging circuit can output 5V 
when charging or up to 4.2V when running from the battery.</p></div></div></div></li></ol></li><li id="comment-207641" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/4a39f24cbf6aef6aadf3b5c838f557dc.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/4a39f24cbf6aef6aadf3b5c838f557dc_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Lucas</span> on <span class="comment-date">September 5, 2016</span><br></li> <li class="single-comment-link"><a href="#comment-207641">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hi!
<br>What happens when you are out of USB power, and the battery voltage gets too low?
<br>This circuit has cut down voltage?
<br>Thanks!</p></div></div></div><ol class="children"><li id="comment-207642" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">September 6, 2016</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-207642">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>No, there is no undervoltage protection in this circuit, the battery should have that built-in to it.</p></div></div></div></li></ol></li><li id="comment-207671" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/70cabee8ae2b0c29cdeef4e75b433583.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/70cabee8ae2b0c29cdeef4e75b433583_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Boyd Roberts</span> on <span class="comment-date">September 25, 2016</span><br></li> <li class="single-comment-link"><a href="#comment-207671">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hi. 
<br>
<br>Can this c code be modified to upload to Arduino? If not, how do I get the c code onto the chip? 
<br>
<br>The are many AC varieties on the microchip website. Which one is recommended? Thanks.
<br>
<br>Everything else should be a piece of cake!
<br>
<br>Thanks</p></div></div></div><ol class="children"><li id="comment-207675" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">September 27, 2016</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-207675">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hey
 Boyd, yea the code be modified to run on Arduino, you will need to 
change the PORT write stuff to digitalWrite(), PIN read stuff to 
digitalRead(), printf to Serial.Print() etc... <br><br>Which AC variant 
to use will depend on what IC package you want and the charge voltage of
 the battery (4.2V - 4.5V). You probably want the SOT-23 package and 
charge voltage of 4.2V, so that's the MCP73832T-2ACI/OT.</p></div></div></div></li></ol></li><li id="comment-207743" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/4cb15cad42f354cc5cd0fd05bc87c1d5.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/4cb15cad42f354cc5cd0fd05bc87c1d5_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">danny</span> on <span class="comment-date">October 19, 2016</span><br></li> <li class="single-comment-link"><a href="#comment-207743">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hi Zak
<br>
<br>I have the mcp73831en a circuit for making environmental parameters, but a sound is perceived when charged using the solar cell.
<br>
<br>help me please</p></div></div></div><ol class="children"><li id="comment-207744" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">October 19, 2016</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-207744">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>This
 Lithium charger is only designed for a steady 5V supply, which a solar 
cell won't be able to provide. You'll have to come up with some 
completely different circuit.</p></div></div></div></li></ol></li><li id="comment-207942" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/e61825c4182345fd81f4db542e6fbf17.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/e61825c4182345fd81f4db542e6fbf17_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">bharath hs</span> on <span class="comment-date">February 14, 2017</span><br></li> <li class="single-comment-link"><a href="#comment-207942">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>hello zak,
<br>
<br>could you please tell me if the irlml6401 mosfet works for this 
circuit. also with the same load sharing components can i use some other
 Charging IC other than MCP7381, like TP4056 IC??</p></div></div></div><ol class="children"><li id="comment-207948" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">February 15, 2017</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-207948">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Heya, IRLML6401 and TP4056 should work fine.</p></div></div></div></li></ol></li><li id="comment-207994" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/8c2ec524a29a078aefe8f5ec06b9ed17.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/8c2ec524a29a078aefe8f5ec06b9ed17_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Anuj</span> on <span class="comment-date">March 19, 2017</span><br></li> <li class="single-comment-link"><a href="#comment-207994">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hi , Zak
<br>
<br>It's a great article.
<br>
<br>I didn't understand the calculation of the R2. The Diode you have 
chosen is D130LAW which has a leakage of 1mA and can be increased with 
increase in temperature. However I am going to use this 
http://www.farnell.com/datasheets/1916075.pdf?_ga=1.255267275.251839788.1488841003
<br>
<br>It has leakage current of 0.2uA @ Vr  = 10v. 
<br>
<br>How to calculate the R1 at this small current? My Load current is 100mA (Max). 
<br>
<br>The transistor should turn ON, even at 4.2 and at 3.2V as well. How 
to calculate the values? I am using the same MOSFET which you used 
DMP1045.</p></div></div></div><ol class="children"><li id="comment-208006" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">March 29, 2017</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-208006">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>That
 diode has a leakage of around 60nA @ 4.2V, which is an effective 
resistance of (4.2 / 0.00000006) = 70MΩ. To have a gate voltage of 0.4V 
when USB is unplugged the maximum resistance of R2 is 0.4 * 70,000,000 /
 (4.2 – 0.4) = 7.4MΩ. However, 7.4M is really high which will cause 
other problems, 100K for R2 will be fine.</p></div></div></div></li></ol></li><li id="comment-208035" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/fd41c2c8447920053aedebcc8c819806.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/fd41c2c8447920053aedebcc8c819806_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Srikanth</span> on <span class="comment-date">April 27, 2017</span><br></li> <li class="single-comment-link"><a href="#comment-208035">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hi
 Zak ! Thank you were much for your informative and useful article. I am
 using this design for a LiPo powered wireless sensor network and need 
to ensure very low power consumption. I have teh following questions :
<br>1. A major issue would be the reverse leakage of D1 which will 
require a 100 K or even lower R2 for ensuring Q1 turn on. I have a large
 stock of IN5819 but they have a large leakage of 1mA so i'll need a 
very small resistor say 10 K. That would leak around 330uA of power when
 my circuit is battery powered.My question is - why not use a IN4001 
instead of a schottky diode which has a leak of &lt;30uA. The forward 
voltage drop is max 1.1 V (at high currents ) and 0.7 V typically at 
lower currents and that is within the acceptable 1.15 V max drop as per 
your calculations.
<br>
<br>2. I am not sure I understand the following statement "So when using
 a diode with a leakage current of 200uA @ 4.2V, R2 must be no more than
 6.56K to keep the MOSFET’s gate at 1V. I’d recommend not going over 
100K for R2." How can you use 100 K when calcs ask for max 6.56K
<br>
<br>3. I will need the MCU to measure LiPO voltage and have a 3.3V LDO 
after the mosfet. Will the Q4 &amp; Q3 circuit in the MCU loadshare you 
have described cause a current drain when standing by PD7 is low if I 
turn off the internal pull up. It appears not.
<br>
<br>4. Finally If I use a IN4001 for D1 and use just a shottky diode 
instead of Q1, I will lose a usable battery life of around 0.3 V but can
 use a 3V LDO instead of 3.3V as my circuit can work on 3V forward. 
Would that be a good idea ?
<br>
<br>Thanks once again
<br>
<br>Srikanth</p></div></div></div><ol class="children"><li id="comment-208062" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">May 19, 2017</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-208062">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hey Srikanth,<br><br>Hmm, yeah I'd think a 1N4001 will work fine. I used a schottky mainly because the app note used one to reduce power losses.<br><br>The
 100K limit is if you were to use a very low leakage diode, where the 
calculated resistor value comes to over 100K. Using a resistor that's 
too high of a value will cause the MOSFET to turn back on too slowly, 
and can cause issues with the gate picking up a charge and not being 
able to get rid of it quickly enough, making the MOSFET turn off even 
when USB is not plugged in.<br><br>Q3/4 will not draw any current when the Q4 input is LOW. PD7 should be configured as an output HIGH/LOW and no pullup.<br><br>Yeah,
 you can use another diode instead of the MOSFET and resistor, then 
whichever power source has the higher voltage will be the one used to 
power the circuit.</p></div></div></div></li></ol></li><li id="comment-208134" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/a17b27333b35351896bfa8a1a3c9a27c.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/a17b27333b35351896bfa8a1a3c9a27c_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Hemal</span> on <span class="comment-date">July 15, 2017</span><br></li> <li class="single-comment-link"><a href="#comment-208134">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hello Zak,
<br>
<br>Can you please confirm the charge circuit with load sharing is 
correct, I think you have D and S swapped of Q1. The mosfet in current 
configuration will act as a diode, isn't it?
<br>
<br>Let me know your thoughts
<br>
<br>Thanks 
<br>Cheers!</p></div></div></div><ol class="children"><li id="comment-208135" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">July 15, 2017</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-208135">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hey
 Hemal, The MOSFET orientation is correct. The diode will not conduct if
 the voltage at the drain (battery side) is lower then the voltage at 
the source (circuit side). If VUSB is applied to Q1 gate and (VUSB 
voltage - D1 Vf drop) is higher than (Vbat - Q1 Vf diode drop) then the 
diode will not conduct. Vusb would have to go down to around 4V before 
anything starts to happen.
<br>
<br>When VUSB is removed the MOSFET will turn on and the diode is bypassed.</p></div></div></div><ol class="children"><li id="comment-208136" class="comment depth-3 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/a17b27333b35351896bfa8a1a3c9a27c.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/a17b27333b35351896bfa8a1a3c9a27c_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Hemal</span> on <span class="comment-date">July 16, 2017</span><br></li> <li class="single-comment-link"><a href="#comment-208136">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Ah, I see it now. You are right. 
<br>Thanks for clarification</p></div></div></div></li></ol></li></ol></li><li id="comment-208144" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/06a2583cf213ab7e97a4c5e8d5a07168.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/06a2583cf213ab7e97a4c5e8d5a07168_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Ta Mak</span> on <span class="comment-date">July 24, 2017</span><br></li> <li class="single-comment-link"><a href="#comment-208144">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hi Zak ,
<br>
<br>This article is really helpful . So thanks a lot .
<br>
<br>I'm intend to use the "load sharing circuit " to my system . My 
circuit would draw about 4.5 A . So I'm planning to use Q1 P - Mosfet  
"NDP6020P  " and where the circuit has a big value of current to be 
drawn I intend to use a diode that has the ability to draw similar 
current so I choose " VS-30EPH06PbF " - this is the data sheet 
http://www.vishay.com/docs/94018/vs-30eph06p.pdf" where it is the 
available in my area .
<br>
<br>I've reviewed the Vsd of "NDP6020P  " which is between 1.1 and 1.3 ,
 while Vf of the diode is about : 1.34 . So the  (Vsource – D1 VF) is 
above (Vbat – Q1 VSD) . 
<br>
<br>I have to mention that the source I'm using is 5v power supplier instead of using USB because of the current limit required.
<br>
<br>So I hope to get your advise about my assumptions . 
<br>Do using these chips would be compatible ?
<br>I'm also thinking about not using C3 , Is it harmful ?
<br>What about the values of R2 ?
<br>
<br>Thanks a lot</p></div></div></div><ol class="children"><li id="comment-208149" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">July 29, 2017</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-208149">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hey Ta, your MOSFET and diode component choice is great, no issues with using those.<br>C3 can be removed without a problem.<br>Since the reverse leakage of the diode is very low R2 can be anywhere from 1K to 100K, I would go for 10K.</p></div></div></div></li></ol></li><li id="comment-208203" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/298a521320125def5936484f4753476f.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/298a521320125def5936484f4753476f_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Olf</span> on <span class="comment-date">September 12, 2017</span><br></li> <li class="single-comment-link"><a href="#comment-208203">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hi Zak,
<br>
<br>thanks for the great article. Possible dumb question: You write "You
 should make sure that your charging power source can supply enough 
current to charge the battery as well as power the circuit.". 
<br>My load regularly draws more current than the charging source can 
provide (ca. 2A dynamic load vs 900mA charger, I have a voltage 
regulator connected between the load sharing circuit and the load), so 
the load operation pauses for regular charging periods. 
<br>
<br>However, during operation I want the circuit to do the following:
<br>The 900mA supply is connected most of the time, so the load should 
draw power from the battery AND the supply simultaneously to decrease 
battery discharge, until the load is deactivated for a charging period, 
or the supply switches off (full load draws from battery).
<br>
<br>Is this possible with your circuit? It looks like Q1 just shuts down
 the battery connection when the supply is connected, and when the load 
draws more than 900mA, the supply voltage drop opens Q1 again (Maybe not
 too healthy for the supply though).
<br>
<br>I think I could do the simultaneous load sharing with the MCP73871 
directly, but I want to avoid hand-soldering a QFN package, also its max
 current is too low for me...
<br>
<br>Thanks :-)
<br>
<br>Olf</p></div></div></div><ol class="children"><li id="comment-208205" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">September 16, 2017</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-208205">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hey
 Olf, drawing power from 2 different voltage sources at the same time 
can be quite tricky (http://www.ti.com/lit/an/slva250/slva250.pdf though
 that's with 2 of the same voltage). If you know when the large current 
draws are going to happen then you could code the microcontroller to 
shut off the charging power source (P-MOSFET on the 5V input) so the 
circuit switches to the battery, then once it's finished reconnect the 
charger.</p></div></div></div></li></ol></li><li id="comment-208263" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/2ee03e2ce1b2bb57b39dfa14fa47a925.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/2ee03e2ce1b2bb57b39dfa14fa47a925_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Florian</span> on <span class="comment-date">November 2, 2017</span><br></li> <li class="single-comment-link"><a href="#comment-208263">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hey
 Zak, nice work! But one Question left: Is there a mistake with the 
MOSFET Q1 in every Picture? I think because of the bypass diode of the 
MOSFET a current will flow to the Load in each case. With or without 
5V-USB plugged in... I think the MOSFET has to be inserted left pin to 
the right and the right pin to the left (gate stays where it is).
<br>
<br>Hope you can answer my question.
<br>
<br>Many Thanks
<br>Florian</p></div></div></div><ol class="children"><li id="comment-208264" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">November 4, 2017</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-208264">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hey
 Florian, the MOSFET orientation in the schematics is correct. As long 
as the source voltage (load side, will be at around 5V with USB) is 
higher than the drain voltage (battery side, max 4.2V) then no current 
will flow. If the MOSFET is flipped then USB power will flow straight 
into the battery through all the diodes, bypassing the charging IC and 
over-charge the battery at an uncontrolled rate (fire will be a likely 
outcome).</p></div></div></div></li></ol></li><li id="comment-208267" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/b85d79b73841b0fd18f1dd4a1eca5ce0.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/b85d79b73841b0fd18f1dd4a1eca5ce0_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Stefan</span> on <span class="comment-date">November 4, 2017</span><br></li> <li class="single-comment-link"><a href="#comment-208267">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hey Zak,
<br>
<br>Great article! I have implemented the circuit as you suggested, and 
it seems to be working fine. However, I noticed somewhat strange 
behavior. 
<br>
<br>In my implementation Vin is directly connected to a USB Mini B 
connector, which in turn is connected via USB cable to a smartphone 
battery charger. All the values presented below are obtained with load 
disconnected. When the battery is not connected, Vin is 5.05V, while 
Vbat (on MCP73831) is 4.3V. As soon as I attach an empty battery 
(~3000mAh 18650 LiIon), Vin drops to ~4.2V and Vbat to ~3.5V. While Vbat
 is slowly increasing over time, Vin stays at ~4.2V. At times, Vin goes 
to ~4.7V while Vbat goes to ~4.5V, then they go back to previous values.
 I understand that Vbat is affected by the charging cycle, but I could 
not figure out why would Vin (USB Vbus) be any different from 5V... Any 
thoughts?
<br>
<br>Thanks in advance.</p></div></div></div><ol class="children"><li id="comment-208271" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">November 5, 2017</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-208271">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>If
 Vin is dropping then that would either mean the power source can't 
provide enough current or the cable you're using can't handle the 
current, causing the voltage to drop a little. Try a few different 
cables, the shorter the better.</p></div></div></div></li></ol></li><li id="comment-208359" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/ac97a69b376d4c0e48ed847ecc2ab7b3.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/ac97a69b376d4c0e48ed847ecc2ab7b3_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Paul</span> on <span class="comment-date">February 5, 2018</span><br></li> <li class="single-comment-link"><a href="#comment-208359">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hi,
<br>
<br>I am new to all this, so I am probably wrong, so:
<br>
<br>I want to replace D1 with another p-channel mosfet - call it Q2. Connect drain to Vin, gate to ground and source to VCC.
<br>
<br>If there is no battery, source will be zero, gate will be zero, Vin 
will be positive, the body diode will conduct and eventually Q2 will 
turn on.
<br>
<br>If there is a battery and vin is disconnected Q1 will start to 
conduct, Q2 will turn on, but it doesn't matter - it still isn't leaking
 current backwards.
<br>
<br>If there is a battery and Vin is connected, Q1 will be off, the body diode in Q2 will conduct and eventually it will turn on.
<br>
<br>Would this work?</p></div></div></div><ol class="children"><li id="comment-208365" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">February 21, 2018</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-208365">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hmm,
 no I don't think that will work. When there is a battery connected and 
VIN is disconnected Q2 will be on allowing current to flow through R2, 
wasting battery power. Q1 will have a voltage at it's gate, likely 
turning it off so all current will be flowing though the body diode. It 
also means the USB connector will be powered, which will back-power an 
unpowered USB device if connected, possibly damaging it or just 
shortening battery life even more.</p></div></div></div></li></ol></li><li id="comment-208430" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/77c11a31d390948909ed88acc746e5ee.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/77c11a31d390948909ed88acc746e5ee_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Sebastian</span> on <span class="comment-date">April 30, 2018</span><br></li> <li class="single-comment-link"><a href="#comment-208430">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hi,
 very nice circuit. I was wondering how do you differentiate the "No 
battery" situation with the "Battery's charge full" situation, when 
external USB power is applied. In both cases, MCP73832 status pin will 
give you the same information, and reading the battery level into the 
ADC will give you for both cases "reasonable battery levels" (When no 
battery is present, you'll still  have a 4.1V reading in the VBAT pin of
 the MCP73832).
<br>The only workaround I found is using the MCP73831 and reading with the MCU three-states (Hi-Z, H, L) using 2 pins.
<br>Any other simpler idea?
<br>This post was great.
<br>Desde Argentina,
<br>Sebastian</p></div></div></div><ol class="children"><li id="comment-208431" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">April 30, 2018</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-208431">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>According
 to the MCP73831 datasheet it applies a continuous 6uA to the battery 
once it has finished charging. If the voltage rises above Vreg + 100mV 
(4.3V) then it determines that the battery is been removed. If it stays 
below that voltage then the battery is present. It's possible to read 
the tri-state output using 1 ADC pin and external resistor, or just a 
single digital pin if the MCU contains both pull-up and pull-down 
resistors. Can't get much simpler than that.</p></div></div></div></li><li id="comment-209662" class="comment depth-2 odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/2b77c7b1c0d75dab9b4c7451df9c7f5e.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/2b77c7b1c0d75dab9b4c7451df9c7f5e_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Raj</span> on <span class="comment-date">June 19, 2021</span><br></li> <li class="single-comment-link"><a href="#comment-209662">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>If I am not wrong, Vbat is always going to be connected to load via parasitic diode of Q1 irrespective of Charger is ON or not.
<br>
<br>So when charger is ON, battery is charging and discharging at the same time, isn't it ?</p></div></div></div><ol class="children"><li id="comment-209663" class="comment depth-3 bypostauthor even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">June 19, 2021</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-209663">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>No, current will not flow through the diode when the voltage at the load side of the MOSFET is greater than (Vbat - diode drop).</p></div></div></div></li></ol></li></ol></li><li id="comment-208494" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/52ecea24ebec7dce6880a0cdf50496e3.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/52ecea24ebec7dce6880a0cdf50496e3_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Andrew Meyer</span> on <span class="comment-date">July 16, 2018</span><br></li> <li class="single-comment-link"><a href="#comment-208494">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hi and thanks so much for the detailed article. I'm a little confused about something you mention in the beginning:
<br>
<br>"When USB power is applied this circuit will turn off Q1, and as 
long as (Vusb – D1 VF) is above (Vbat – Q1 VSD) then the load will 
instead use power from USB through D1"
<br>
<br>Shouldn't the node on the source of the mosfet be defined by Vbat - 
Q1VDS (not SD), or even just Vbat + Q1VSD? By convention, it seems that 
VDS = VD - VS, which would be a positive number and seems to describe 
the amount of voltage lost across the mosfet when current is going from 
drain to source.
<br>
<br>That said, I'm also looking at this datasheet 
(http://static6.arrow.com/aropdfconversion/c9282694b401720599c2315f8524a95bfe22c148/vp0106.pdf),
 which describes VSD as a negative number. This would make sense since 
VDS = -VDS, however the current in the "condition" column is also 
negative (ISD = -500mA) so now I'm really confused...</p></div></div></div><ol class="children"><li id="comment-208495" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">July 16, 2018</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-208495">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hey Andrew,<br>When
 Q1 is off we're interested in the MOSFET's internal diode forward 
voltage drop, which is defined as Vsd. Vds is used when the MOSFET is 
on. But you're right about the Vsd being a negative number in the 
datasheets, this article was written assuming the diode drop was a 
positive value. I'm not sure if I should change it to the correct 
calculation as I think most people always assume that diode voltage 
drops are positive?<br><br>P channel things are always a confusing pain 
with their negative values, some datasheets show some parameters as 
positive numbers and other datasheets as negative...</p></div></div></div></li></ol></li><li id="comment-208514" class="comment depth-1 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/40a792fb39e619c76f8cc3eebd1f26ae.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/40a792fb39e619c76f8cc3eebd1f26ae_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">José</span> on <span class="comment-date">July 31, 2018</span><br></li> <li class="single-comment-link"><a href="#comment-208514">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hi, thanks for this information! I have a couple of questions: 
<br>1)Will the p-channel mosfet give reverse polarity protection too? it seems that it should, but im not sure...
<br>2)I found a diode with with around 2uA leakage, but according to the
 calculations i should use value for R2 around 6MEG.  do you think it's 
worth to do it this way?
<br>Thanks for your help!</p></div></div></div><ol class="children"><li id="comment-208516" class="comment depth-2 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">July 31, 2018</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-208516">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Hey Jose,<br>1)
 No, if the MOSFET is on then current will flow backwards through it 
bypassing the diode, so no protection there. You'll also probably damage
 the charging IC too.<br>2) I wouldn't use a resistor higher than 100K 
for R2, otherwise it won't be able to get rid of any build-up of charge 
quick enough (like touching the 5V input with your finger) and the 
MOSFET might turn off.</p></div></div></div><ol class="children"><li id="comment-208518" class="comment depth-3 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/40a792fb39e619c76f8cc3eebd1f26ae.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/40a792fb39e619c76f8cc3eebd1f26ae_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">José</span> on <span class="comment-date">August 1, 2018</span><br></li> <li class="single-comment-link"><a href="#comment-208518">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>thanks for your reply! 
<br>wouldn't the MOSFET be off if i reverse polarity with USB input 
disconnected?   I ask you because i have seen a reverse polarity 
protection circuit that uses a reversed P-CHANNEL MOSFET like the one 
used here...</p></div></div></div><ol class="children"><li id="comment-208519" class="comment depth-4 bypostauthor odd"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29.jpeg" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/29472aca98cc6bcd8723f3ce7a187e29_002.jpeg 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">Zak Kemble</span> on <span class="comment-date">August 1, 2018</span><br><span class="label label-primary author-cred">Author</span></li> <li class="single-comment-link"><a href="#comment-208519">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>Ah
 yes you're right, I think it might work as reverse protection then, 
you'll have to test it! I didn't think about ground now being at the 
battery positive, applying a voltage to the MOSFET gate through R2 and 
turning it off. :P
<br>Though the charging IC won't have any protection as it's directly connected to the battery.</p></div></div></div><ol class="children"><li id="comment-208520" class="comment depth-5 even"><div class="row"><div class="comment-wrap col-md-12"><ul class="comment-meta"><li class="comment-avatar"><img class="avatar avatar-50 photo" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/40a792fb39e619c76f8cc3eebd1f26ae.png" srcset="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/40a792fb39e619c76f8cc3eebd1f26ae_002.png 2x" alt="Avatar" loading="lazy" style="width: 50px; height: 50px;"></li> <li class="comment-attr"><span class="comment-author">José</span> on <span class="comment-date">August 2, 2018</span><br></li> <li class="single-comment-link"><a href="#comment-208520">#</a></li> <li class="comment-reply"><a href="#" class="btn btn-xs comment-reply-link" rel="nofollow">Reply</a></li></ul><div class="comment-entry"><p>thanks! you are right, there won't be protection for the IC.</p></div></div></div></li></ol></li></ol></li></ol></li></ol></li></ol></div>
	<div id="pages_container" class="pagination-wrapper"><ul class="pagination"><li class="disabled"><span class="prev page-numbers">« Prev</span></li><li class="page-numbers active"><a class="" href="https://blog.zakkemble.net/a-lithium-battery-charger-with-load-sharing/comment-page-1/">1</a></li><li class="page-numbers"><a class="" href="https://blog.zakkemble.net/a-lithium-battery-charger-with-load-sharing/comment-page-2/">2</a></li><li><a class="next page-numbers" href="https://blog.zakkemble.net/a-lithium-battery-charger-with-load-sharing/comment-page-2/">Next »</a></li></ul></div>
	<div id="reply_container">
		<div id="respond" class="comment-respond">
			<h3 class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" class="btn btn-sm" href="#" style="display:none">Cancel reply</a></small></h3>
			<form id="commentform" class="comment-form" method="post" action="#">
				<p class="comment-notes">
					<small>Your email address will not be published.<br>
					Please do not use @outlook, @live or @hotmail addresses.<br>
					Please use <a href="https://pastebin.com/" target="_blank" rel="noopener noreferrer">https://pastebin.com/</a> for large amounts of code.<br>
					<a href="https://kramdown.gettalong.org/quickref.html" target="_blank" rel="noopener noreferrer">Markdown</a> is allowed.</small>
				</p>
				<div class="form-group">
					<label for="comment" class="sr-only"></label>
					<textarea name="content" id="comment" class="form-control" cols="40" rows="10" aria-required="true" placeholder="Your message" required=""></textarea>
				</div>
				<div class="row">
					<div class="form-group col-sm-4">
						<label for="name" class="sr-only"></label>
						<input type="text" class="form-control" aria-required="true" name="name" id="name" placeholder="Name" required="">
					</div>
					<div class="form-group col-sm-4">
						<label for="email" class="sr-only"></label>
						<input type="email" class="form-control" aria-required="true" name="email" id="email" placeholder="Email" required="">
					</div>
					<div class="form-group col-sm-4">
						<label for="url" class="sr-only"></label>
						<input type="text" class="form-control" name="url" id="url" placeholder="Website (optional)">
					</div>
					<div class="form-group col-sm-12">
						<i class="far fa-circle"></i><input type="checkbox" name="subscribe" id="subscribe" class="unloaded">
						<label for="subscribe">Subscribe to comment replies</label>
					</div>
				</div>
				<p class="form-submit">
					<input name="submit" type="submit" id="submit" class="submit btn" value="Submit Comment">
					<input type="hidden" name="action" value="newcomment">
					<input type="hidden" name="pk" id="pk" value="1255">
					<input type="hidden" name="reply_to" id="reply_to" value="0">
				</p>
				<p id="sendstatus"></p>
			</form>
		</div>
	</div>
	<div>
		<div id="subscribe2" class="comment-respond">
			<form id="subscribeform" class="comment-form" method="post" action="#">
				<p>Subscribe to comment replies without commenting:</p>
				<div class="row">
					<div class="form-group col-sm-12">
						<label for="email" class="sr-only"></label>
						<input type="email" class="form-control" aria-required="true" name="email" id="subs_email" placeholder="Email" required="">
					</div>
				</div>
				<p class="form-submit">
					<input name="submit" type="submit" id="subs_submit" class="submit btn" value="Subscribe">
					<input type="hidden" name="action" value="subscribe">
					<input type="hidden" name="pk" value="1255">
				</p>
				<p id="subs_sendstatus"></p>
			</form>
		</div>
	</div>
</div>
 <div id="related-posts" class="mt-5 mb-2 mb-sm-4">
   <h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip="">Further Reading</h3>
   <div class="card-deck mb-4">
     <div class="card">
        <a href="https://blog.zakkemble.net/laptop-bench-power-supply/">
         <div class="card-body">
<em class="small">30 Sep 2019</em>
           <h3 class="pt-0 mt-1 mb-3" data-toc-skip="">Laptop Bench Power Supply</h3>
           <div class="text-muted small">
             <p>
                Many years ago (September 2009) I made a simple bench 
power supply using an LT1083 7.5A linear regulator with adjustable 
output voltage designed to be used with a 19.5V 3.42A laptop power 
supply. I...
             </p>
           </div>
         </div>
        </a>
     </div>
     <div class="card">
        <a href="https://blog.zakkemble.net/smart-power-bank-keep-alive/">
         <div class="card-body">
<em class="small">10 Feb 2020</em>
           <h3 class="pt-0 mt-1 mb-3" data-toc-skip="">Smart Power Bank Keep-Alive</h3>
           <div class="text-muted small">
             <p>
                Ever wanted to power a project from a USB power bank, 
only to have it keep shutting itself off because the current draw was 
too low? This project aims to fix that with these handy and slightly 
over...
             </p>
           </div>
         </div>
        </a>
     </div>
     <div class="card">
        <a href="https://blog.zakkemble.net/repairing-a-samsung-ht-c460-home-cinema-system/">
         <div class="card-body">
<em class="small">20 Apr 2021</em>
           <h3 class="pt-0 mt-1 mb-3" data-toc-skip="">Repairing a Samsung HT-C460 Home Cinema System</h3>
           <div class="text-muted small">
             <p>
                My Samsung HT-C460 home cinema had started to go into 
protection mode – it would display “PROT” on its screen and turn off 
after a few seconds. It’s an old cinema system with a DVD player that 
hasn...
             </p>
           </div>
         </div>
        </a>
     </div>
   </div>
 </div>
<div class="post-navigation d-flex justify-content-between">
  <a href="https://blog.zakkemble.net/ic-samples/" class="btn btn-outline-primary" prompt="Older">
   <p>IC Samples</p>
  </a>
  <a href="https://blog.zakkemble.net/bluetooth-net-monitor-v2/" class="btn btn-outline-primary" prompt="Newer">
   <p>Bluetooth Net Monitor v2</p>
  </a>
</div>
 </div>
</div>
<footer class="row pl-3 pr-3">
 <div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0">
   <div class="footer-left">
     <p class="mb-0">
        © 2022
        <a href="https://zakkemble.net/">Zak kemble</a>.
     </p>
   </div>
   <div class="footer-right">
     <p class="mb-0">
        .
     </p>
   </div>
 </div>
</footer>
     </div>
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
 <div class="col-12 col-sm-11 post-content">
   <div id="search-hints">
 <div id="access-tags">
   <div class="panel-heading">Trending Tags</div>
   <div class="d-flex flex-wrap mt-3 mb-1 mr-3">
      <a class="post-tag" href="https://blog.zakkemble.net/tags/attiny/">attiny</a>
      <a class="post-tag" href="https://blog.zakkemble.net/tags/electronics/">electronics</a>
      <a class="post-tag" href="https://blog.zakkemble.net/tags/avr/">avr</a>
      <a class="post-tag" href="https://blog.zakkemble.net/tags/linux/">linux</a>
      <a class="post-tag" href="https://blog.zakkemble.net/tags/raspberry-pi/">raspberry pi</a>
      <a class="post-tag" href="https://blog.zakkemble.net/tags/telegram/">telegram</a>
      <a class="post-tag" href="https://blog.zakkemble.net/tags/esp8266/">esp8266</a>
      <a class="post-tag" href="https://blog.zakkemble.net/tags/internet-of-things/">internet of things</a>
      <a class="post-tag" href="https://blog.zakkemble.net/tags/iot/">iot</a>
      <a class="post-tag" href="https://blog.zakkemble.net/tags/compiler/">compiler</a>
   </div>
 </div>
   </div>
   <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
 </div>
</div>
   </div>
   <div id="mask"></div>
    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button" style="display: inline;">
      <i class="fas fa-angle-up"></i>
    </a>
<script src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/simple-jekyll-search.js"></script>
<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="{url}">{title}</a> <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags} </div><p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No results found.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }
    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>
  <script src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/clipboard.js"></script>
  <script src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/localizedFormat.js"></script>
<script defer="defer" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/post.js"></script>
<script src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/bootstrap.js"></script>
	<script src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/script.js"></script>
	<script src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/script_002.js"></script>
    <script defer="defer" src="A%20Lithium%20Battery%20Charger%20with%20Load%20Sharing%20|%20Zak%E2%80%99s%20Electronics%20Blog%20~*_files/unregister.js"></script>
 

<iframe style="overflow: hidden auto; width: 1920px; height: 886px; position: fixed; top: 0px; left: 0px; border: medium none; z-index: 9999; max-width: 100%; display: none;"></iframe></body></html>